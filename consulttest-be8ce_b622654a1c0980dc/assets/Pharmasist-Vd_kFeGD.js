import{r as i,j as e,C as ve,a as Ce,b as we,P as me,f as Ae,A as qe,g as he,h as Je,B as d,e as b,U as Ye,Y as Ke,X as De,$ as ke,a0 as Se,a1 as Pe,a2 as Te,a3 as Be,L as Ue,a5 as Ge,a4 as Fe,p as $,q as w,t as V,u as J,v as Y,w as C,x as Ie,s as ae,H as K,i as ie,_ as _e,F as ce,n as ea,Z as oe,a6 as aa,a7 as sa,a8 as He,a9 as Oe,d as ta,T as $e,M as Ve,N as de,O as y,Q as Qe,W as v,V as ra,m as la,z as na}from"./index-COWPSwuG.js";import{U as Xe,a as xe,C as ue,L as ze}from"./user-x-Ca6qzlEV.js";import{f as S,P as ia}from"./format-B6mXiQzZ.js";import{A as ca,B as oa}from"./building-DYKYV5F4.js";const da=({currentUser:p})=>{const[c,pe]=i.useState("available"),[Ee,se]=i.useState(!0),[X,W]=i.useState(!1),[Q,Z]=i.useState(""),[B,j]=i.useState([]),[s,F]=i.useState(!1),[L,te]=i.useState(""),[z,x]=i.useState(!1),[N,be]=i.useState(30),[E,ge]=i.useState([]),[re,R]=i.useState("");i.useEffect(()=>{const r=async()=>{try{const g=$(w,"users",p.uid);return V(g,T=>{if(T.exists()){const _=T.data();pe(_.availabilityStatus||"available"),ge(_.availabilityHistory||[])}se(!1)})}catch(g){console.error("Error fetching pharmacist status:",g),Z("Failed to load availability status"),se(!1)}},U=async()=>{try{const g=J(Y(w,"cases"),C("pharmacistId","==",p.uid),C("pharmacistCompleted","==",!1));return V(g,T=>{j(T.docs.length)})}catch(g){console.error("Error fetching active cases:",g)}};return r(),U(),()=>{}},[p.uid]);const M=async(r,U="",g=null)=>{try{W(!0);const P=Ie(),T=$(w,"users",p.uid),_=await ae(T);if(!_.exists())throw new Error("Pharmacist profile not found");const je=_.data().availabilityHistory||[],I={previousStatus:c,newStatus:r,changedAt:new Date,reason:U};if(g){I.expectedDuration=g;const t=new Date;t.setMinutes(t.getMinutes()+g),I.expectedReturnTime=t}const ne=[I,...je];let a={};r==="on_break"&&(a={breakStartedAt:P,breakDuration:g}),await K(T,{availabilityStatus:r,lastStatusUpdate:P,availabilityHistory:ne,...a}),F(!1),x(!1),te(""),W(!1)}catch(P){console.error("Error updating status:",P),Z("Failed to update availability status"),W(!1)}},G=r=>{r==="unavailable"?(R("unavailable"),F(!0)):r==="on_break"?(R("break"),x(!0)):M(r)},q=()=>{switch(c){case"available":return e.jsx(d,{className:"bg-green-100 text-green-800 border-green-200",children:"Available"});case"busy":return e.jsx(d,{className:"bg-red-100 text-red-800 border-red-200",children:"Busy"});case"unavailable":return e.jsx(d,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"Unavailable"});case"on_break":return e.jsx(d,{className:"bg-amber-100 text-amber-800 border-amber-200",children:"On Break"});default:return e.jsx(d,{variant:"outline",children:"Unknown"})}},le=()=>{switch(c){case"available":return"bg-green-100 text-green-800 border-green-200";case"busy":return"bg-red-100 text-red-800 border-red-200";case"unavailable":return"bg-gray-100 text-gray-800 border-gray-200";case"on_break":return"bg-amber-100 text-amber-800 border-amber-200";default:return""}};return i.useEffect(()=>{c==="available"&&B.length>=10&&(console.log("hi"),M("busy","Automatically marked as busy due to high case load"))},[B,c]),Ee?e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ve,{className:"border border-gray-100 shadow-md",children:[e.jsx(Ce,{className:`pb-4 ${le()}`,children:e.jsxs(we,{className:"flex items-center text-xl",children:[e.jsx(me,{className:"h-5 w-5 mr-2"}),"Availability Management"]})}),e.jsxs(Ae,{className:"pt-6",children:[Q&&e.jsxs(qe,{variant:"destructive",className:"mb-4",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(Je,{children:Q})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Current Status"}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${c==="available"?"bg-green-500":c==="busy"?"bg-red-500":c==="unavailable"?"bg-gray-500":"bg-amber-500"}`}),e.jsxs("p",{className:"font-medium",children:["You are currently ",q()]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("p",{className:"mr-2 text-sm text-gray-500",children:["Active Cases:",e.jsx("span",{className:`ml-1 font-medium ${B.length>=10?"text-red-600":"text-green-600"}`,children:B.length})]}),e.jsx(d,{className:B.length>=10?"bg-red-100 text-red-800":"bg-green-100 text-green-800",children:B.length>=10?"High Load":"Available"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(b,{variant:c==="available"?"default":"outline",className:c==="available"?"bg-green-600 hover:bg-green-700":"",onClick:()=>G("available"),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Available"]}),e.jsxs(b,{variant:c==="busy"?"default":"outline",className:c==="busy"?"bg-red-600 hover:bg-red-700":"",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Busy"]}),e.jsxs(b,{variant:c==="unavailable"?"default":"outline",className:c==="unavailable"?"bg-gray-600 hover:bg-gray-700":"",onClick:()=>G("unavailable"),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Unavailable"]}),e.jsxs(b,{variant:c==="on_break"?"default":"outline",className:c==="on_break"?"bg-amber-600 hover:bg-amber-700":"",onClick:()=>G("on_break"),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Lunch Break"]})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(Ke,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Status Explanation"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-gray-600",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-green-600",children:"Available:"})," Ready to accept new cases"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-red-600",children:"Busy:"})," Already handling maximum cases"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Unavailable:"})," Off duty or not working"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-amber-600",children:"Lunch Break:"})," Temporarily unavailable"]})]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-md font-medium flex items-center",children:[e.jsx(De,{className:"h-4 w-4 mr-2 text-blue-500"}),"Recent Status Changes"]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-[300px] overflow-y-auto",children:E.length===0?e.jsx("p",{className:"text-gray-500 text-center",children:"No status changes recorded"}):e.jsx("div",{className:"space-y-3",children:E.map((r,U)=>e.jsxs("div",{className:"bg-white p-3 rounded border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${r.newStatus==="available"?"bg-green-500":r.newStatus==="busy"?"bg-red-500":r.newStatus==="unavailable"?"bg-gray-500":"bg-amber-500"}`}),e.jsx("span",{className:"font-medium",children:r.newStatus==="available"?"Available":r.newStatus==="busy"?"Busy":r.newStatus==="unavailable"?"Unavailable":"On Break"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:r.changedAt instanceof Date?S(r.changedAt,"MMM d, h:mm a"):"Recently"})]}),r.reason&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Reason: ",r.reason]}),r.expectedDuration&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Duration: ",r.expectedDuration," minutes"]}),r.previousStatus&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Previous: ",r.previousStatus==="available"?"Available":r.previousStatus==="busy"?"Busy":r.previousStatus==="unavailable"?"Unavailable":"On Break"]})]},U))})})]})]})]})]}),e.jsx(ke,{open:s,onOpenChange:F,children:e.jsxs(Se,{className:"sm:max-w-md",children:[e.jsxs(Pe,{children:[e.jsxs(Te,{className:"flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 text-gray-600 mr-2"}),"Mark as Unavailable"]}),e.jsx(Be,{children:"Please provide a reason for marking yourself as unavailable."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ue,{htmlFor:"unavailableReason",children:"Reason for unavailability"}),e.jsx(Ge,{id:"unavailableReason",value:L,onChange:r=>te(r.target.value),placeholder:"e.g., Taking time off, personal emergency, etc.",className:"min-h-[100px]"})]})}),e.jsxs(Fe,{className:"sm:justify-between",children:[e.jsx(b,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(b,{onClick:()=>M("unavailable",L),disabled:X||!L.trim(),className:"bg-gray-600 hover:bg-gray-700",children:X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"})," Mark as Unavailable"]})})]})]})}),e.jsx(ke,{open:z,onOpenChange:x,children:e.jsxs(Se,{className:"sm:max-w-md",children:[e.jsxs(Pe,{children:[e.jsxs(Te,{className:"flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 text-amber-500 mr-2"}),"Lunch Break"]}),e.jsx(Be,{children:"Please select how long you'll be on break."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ue,{htmlFor:"breakDuration",children:"Break Duration (minutes)"}),e.jsx("div",{className:"flex space-x-2",children:[15,30,45,60].map(r=>e.jsx(b,{type:"button",variant:N===r?"default":"outline",className:N===r?"bg-amber-600 hover:bg-amber-700":"",onClick:()=>be(r),children:r},r))}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:['Your status will be marked as "On Break" for ',N," minutes."]})]})}),e.jsxs(Fe,{className:"sm:justify-between",children:[e.jsx(b,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(b,{onClick:()=>M("on_break",`Taking a ${N} minute break`,N),disabled:X,className:"bg-amber-600 hover:bg-amber-700",children:X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2"})," Start Break"]})})]})]})})]})},pa=({currentUser:p})=>{var ne;const[c,pe]=i.useState([]),[Ee,se]=i.useState([]),[X,W]=i.useState([]),[Q,Z]=i.useState(!0),[B,j]=i.useState(""),[s,F]=i.useState(null),[L,te]=i.useState("availability"),[z,x]=i.useState(!1),[N,be]=i.useState({status:"available",lastUpdate:null,history:[]}),[E,ge]=i.useState({}),[re,R]=i.useState({open:!1,cases:[],batchTimestamp:null}),[M,G]=i.useState([]),q=async(a,t=3)=>{let u;for(let o=0;o<t;o++)try{return await a()}catch(h){console.error(`Operation failed (attempt ${o+1}/${t}):`,h),u=h,await new Promise(A=>setTimeout(A,Math.pow(2,o)*100))}throw u};i.useEffect(()=>{const a=async()=>{try{c.length>=10&&N.status==="available"?(console.log("Auto-updating pharmacist status to busy - case count:",c.length),await P("busy","Automatically marked as busy due to high case load")):c.length<10&&N.status==="busy"&&(console.log("Auto-updating pharmacist status to available - case count:",c.length),await P("available","Automatically marked as available due to reduced case load"))}catch(t){console.error("Error in pharmacist auto status update:",t)}};c.length!==void 0&&N.status&&!Q&&a()},[c.length,N.status,Q]);const le=async a=>{try{const t=new Date,u=$(w,"cases",a.id),o=await ae(u);if(!o.exists())throw new Error("Case not found");const h=o.data();if(h.pharmacistJoined){console.warn("Pharmacist has already joined this case.");return}const A={pharmacistJoined:t};if(h.batchCode){const D=J(Y(w,"cases"),C("batchCode","==",h.batchCode));(await na(D)).forEach(async ee=>{const fe=ee.ref;await q(()=>K(fe,A))})}else await q(()=>K(u,A))}catch{console.error("Error setting pharmacist joining time: ",err)}};i.useEffect(()=>{const a=async()=>{try{const h=$(w,"users",p.uid);return V(h,D=>{if(D.exists()){const H=D.data();be({status:H.availabilityStatus||"available",lastUpdate:H.lastStatusUpdate,history:H.availabilityHistory||[]})}})}catch(h){console.error("Error fetching pharmacist status:",h)}},t=async()=>{try{const h=J(Y(w,"cases"),C("pharmacistId","==",p.uid),C("pharmacistCompleted","==",!1),C("isIncomplete","!=",!0)),A=V(h,O=>{const f=[],n={};O.forEach(l=>{const m=l.data();if(m.batchCreated&&m.batchTimestamp){const k=m.batchTimestamp.toString();n[k]||(n[k]=[]),n[k].push({id:l.id,...m,createdAtFormatted:m.createdAt?S(m.createdAt.toDate(),"PPpp"):"",doctorCompletedAtFormatted:m.doctorCompletedAt?S(m.doctorCompletedAt.toDate(),"PPpp"):""})}f.push({id:l.id,...m,createdAtFormatted:m.createdAt?S(m.createdAt.toDate(),"PPpp"):"",doctorCompletedAtFormatted:m.doctorCompletedAt?S(m.doctorCompletedAt.toDate(),"PPpp"):""})}),pe(f),ge(n)}),D=J(Y(w,"cases"),C("pharmacistId","==",p.uid),C("pharmacistCompleted","==",!1),C("isIncomplete","!=",!0)),H=V(D,O=>{const f=[];O.forEach(n=>{const l=n.data();f.push({id:n.id,...l,createdAtFormatted:l.createdAt?S(l.createdAt.toDate(),"PPpp"):"Not available",doctorCompletedAtFormatted:l.doctorCompletedAt?S(l.doctorCompletedAt.toDate(),"PPpp"):"Not completed yet"})}),f.sort((n,l)=>{var m,k,Me,Le;if(n.isIncomplete&&!l.isIncomplete)return 1;if(!n.isIncomplete&&l.isIncomplete||n.doctorCompleted&&!l.doctorCompleted)return-1;if(!n.doctorCompleted&&l.doctorCompleted)return 1;if(n.doctorCompleted&&l.doctorCompleted){const Ne=(m=n.doctorCompletedAt)!=null&&m.toDate?n.doctorCompletedAt.toDate():new Date(0),ye=(k=l.doctorCompletedAt)!=null&&k.toDate?l.doctorCompletedAt.toDate():new Date(0);return Ne-ye}else{const Ne=(Me=n.createdAt)!=null&&Me.toDate?n.createdAt.toDate():new Date(0),ye=(Le=l.createdAt)!=null&&Le.toDate?l.createdAt.toDate():new Date(0);return Ne-ye}}),G(f)}),ee=J(Y(w,"cases"),C("pharmacistId","==",p.uid),C("isIncomplete","==",!0)),fe=V(ee,O=>{const f=[];O.forEach(n=>{const l=n.data();f.push({id:n.id,...l,createdAtFormatted:l.createdAt?S(l.createdAt.toDate(),"PPpp"):"",doctorCompletedAtFormatted:l.doctorCompletedAt?S(l.doctorCompletedAt.toDate(),"PPpp"):""})}),f.sort((n,l)=>{var m,k;return((m=l.doctorCompletedAt)==null?void 0:m.toDate())-((k=n.doctorCompletedAt)==null?void 0:k.toDate())}),W(f)}),We=J(Y(w,"cases"),C("pharmacistId","==",p.uid),C("pharmacistCompleted","==",!0)),Ze=V(We,O=>{const f=[];O.forEach(n=>{const l=n.data();f.push({id:n.id,...l,createdAtFormatted:l.createdAt?S(l.createdAt.toDate(),"PPpp"):"",doctorCompletedAtFormatted:l.doctorCompletedAt?S(l.doctorCompletedAt.toDate(),"PPpp"):"",pharmacistCompletedAtFormatted:l.pharmacistCompletedAt?S(l.pharmacistCompletedAt.toDate(),"PPpp"):""})}),f.sort((n,l)=>{var m,k;return((m=l.pharmacistCompletedAt)==null?void 0:m.toDate())-((k=n.pharmacistCompletedAt)==null?void 0:k.toDate())}),se(f),Z(!1)});return()=>{A(),H(),fe(),Ze()}}catch(h){console.error("Error fetching cases:",h),j("Failed to load cases"),Z(!1)}},u=a(),o=t();return()=>{typeof u=="function"&&u(),typeof o=="function"&&o()}},[p.uid]);const r=a=>{F(a)},U=async a=>{if(a)try{x(!0);const t=$(w,"cases",a),u=await ae(t);if(!u.exists())throw new Error("Case not found");const o=u.data();if(!o.doctorCompleted||!o.doctorCompletedAt){j("This case cannot be marked incomplete until the doctor has completed their review."),x(!1);return}if(o.isIncomplete){j("This case has been marked as incomplete by the doctor and cannot be marked incomplete by you."),x(!1);return}if(o.pharmacistCompleted){j("This case has already been completed."),x(!1);return}const h=new Date,A=o.version||0;try{await q(()=>K(t,{pharmacistCompleted:!0,inPharmacistPendingReview:!1,status:"pharmacist_incomplete",pharmacistCompletedAt:h,pharmacistCompletedBy:p.uid,pharmacistCompletedByName:p.displayName||"Pharmacist",version:A+1,isIncomplete:!0}))}catch(D){console.error("Error updating case after retries:",D),j("Failed to update case after multiple attempts. Please try again."),x(!1);return}F(null),x(!1)}catch(t){console.error("Error completing case:",t),j("Failed to complete case"),x(!1)}},g=async a=>{if(a)try{x(!0);const t=$(w,"cases",a),u=await ae(t);if(!u.exists())throw new Error("Case not found");const o=u.data();if(!o.doctorCompleted||!o.doctorCompletedAt){j("This case cannot be completed until the doctor has completed their review."),x(!1);return}if(o.isIncomplete){j("This case has been marked as incomplete by the doctor and cannot be completed."),x(!1);return}if(o.pharmacistCompleted){j("This case has already been completed."),x(!1);return}const h=new Date,A=o.version||0;try{await q(()=>K(t,{pharmacistCompleted:!0,inPharmacistPendingReview:!1,status:"completed",pharmacistCompletedAt:h,pharmacistCompletedBy:p.uid,pharmacistCompletedByName:p.displayName||"Pharmacist",version:A+1}))}catch(D){console.error("Error updating case after retries:",D),j("Failed to update case after multiple attempts. Please try again."),x(!1);return}F(null),x(!1),c.length<10&&N.status==="busy"&&P("available","Automatically marked as available due to reduced case load")}catch(t){console.error("Error completing case:",t),j("Failed to complete case"),x(!1)}},P=async(a,t="")=>{try{const u=new Date,o=$(w,"users",p.uid),h=await ae(o);if(!h.exists())throw new Error("Pharmacist profile not found");const D=h.data().availabilityHistory||[],ee=[{previousStatus:N.status,newStatus:a,changedAt:u,reason:t},...D];await K(o,{availabilityStatus:a,lastStatusUpdate:u,availabilityHistory:ee})}catch(u){console.error("Error updating status:",u),j("Failed to update availability status")}},T=a=>{switch(a){case"pending":return e.jsx(d,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Pending"});case"doctor_completed":return e.jsx(d,{className:"bg-amber-100 text-amber-800 border-amber-200",children:"Doctor Completed"});case"doctor_incomplete":return e.jsx(d,{className:"bg-red-100 text-red-800 border-red-200",children:"Doctor Marked Incomplete"});case"pharmacist_incomplete":return e.jsx(d,{className:"bg-red-100 text-red-800 border-red-200",children:"Pharmacist Marked Incomplete"});case"completed":return e.jsx(d,{className:"bg-green-100 text-green-800 border-green-200",children:"Fully Completed"});default:return e.jsx(d,{variant:"outline",children:"Unknown"})}},_=()=>{switch(N.status){case"available":return e.jsxs(d,{className:"bg-green-100 text-green-800 border-green-200",children:[e.jsx(Xe,{className:"h-3.5 w-3.5 mr-1.5"}),"Available"]});case"busy":return e.jsxs(d,{className:"bg-red-100 text-red-800 border-red-200",children:[e.jsx(Ye,{className:"h-3.5 w-3.5 mr-1.5"}),"Busy"]});case"unavailable":return e.jsxs(d,{className:"bg-gray-100 text-gray-800 border-gray-200",children:[e.jsx(xe,{className:"h-3.5 w-3.5 mr-1.5"}),"Unavailable"]});case"on_break":return e.jsxs(d,{className:"bg-amber-100 text-amber-800 border-amber-200",children:[e.jsx(ue,{className:"h-3.5 w-3.5 mr-1.5"}),"On Break"]});default:return e.jsx(d,{variant:"outline",children:"Unknown"})}};if(Q)return e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})});const Re=a=>{E[a]&&R({open:!0,cases:E[a],batchTimestamp:a})},je=a=>{if(a.batchCreated&&a.batchTimestamp){const t=a.batchTimestamp.toString();return E[t]&&E[t].length>1}return!1},I=a=>{if(a.batchCreated&&a.batchTimestamp){const t=a.batchTimestamp.toString();return E[t]?E[t].length:0}return 0};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-full",children:e.jsx(me,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Pharmacist Dashboard"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-2",children:"Status:"}),_(),e.jsx("span",{className:"text-sm text-gray-500 ml-4 mr-2",children:"Active Cases:"}),e.jsxs(d,{className:c.length>=10?"bg-red-100 text-red-800":"bg-green-100 text-green-800",children:[c.length,"/10"]})]})]})]}),s&&e.jsxs(b,{variant:"outline",onClick:()=>F(null),className:"flex items-center border-green-200 text-green-600 hover:bg-green-50",children:[e.jsx(ca,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})]}),B&&e.jsxs(qe,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(Je,{children:B})]}),s?e.jsxs(ve,{className:"border border-gray-100 shadow-md",children:[e.jsxs(Ce,{className:"bg-green-50 pb-4 flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(we,{className:"flex items-center text-xl",children:[e.jsx(ie,{className:"h-5 w-5 text-green-600 mr-2"}),Array.isArray(s.patientNames)?e.jsxs(e.Fragment,{children:[s.patientNames[0],s.patientCount>1&&e.jsxs(d,{variant:"outline",className:"ml-2 text-xs bg-green-50 text-green-600",children:["+",s.patientCount-1," more"]})]}):s.patientName]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Total Patients:"," ",Array.isArray(s.patientNames)?s.patientCount:1]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(d,{className:"text-sm bg-green-100 text-green-800 border-green-200",children:s.consultationType==="tele"?"Tele Consultation":"Audio Consultation"}),s.isIncomplete&&e.jsxs(d,{className:"text-sm bg-red-100 text-red-800 border-red-200",children:[e.jsx(_e,{className:"h-3.5 w-3.5 mr-1.5"}),"Marked Incomplete by Doctor"]})]})]}),e.jsx(Ae,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-md font-medium flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 mr-2 text-green-500"}),"Patient Details"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[Array.isArray(s.patientNames)?e.jsxs("div",{className:"mb-4 border-b pb-3 border-gray-200",children:[e.jsxs("h4",{className:"font-medium text-green-700 mb-2",children:["Patient Information (",s.patientCount,")"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-3",children:s.patientNames.map((a,t)=>e.jsxs("div",{className:"bg-white p-3 rounded border border-gray-100",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsxs("span",{className:"font-medium text-gray-600 w-28",children:["Patient #",t+1,":"]}),e.jsx("span",{className:"text-gray-800",children:a})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"EMR:"}),e.jsx("span",{className:"text-gray-800",children:s.emrNumbers[t]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Complaint:"}),e.jsx("span",{className:"text-gray-800",children:s.chiefComplaints[t]})]})]},t))})]}):e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Chief Complaint:"}),e.jsx("span",{className:"text-gray-800",children:s.chiefComplaint})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Clinic:"}),e.jsx("span",{className:"text-gray-800",children:s.clinicName})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Created:"}),e.jsx("span",{className:"text-gray-800",children:s.createdAtFormatted})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Created By:"}),e.jsx("span",{className:"text-gray-800",children:s.createdByName||"Unknown"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Status:"}),e.jsx("span",{children:T(s.status)})]})]}),e.jsxs("h3",{className:"text-md font-medium flex items-center pt-2",children:[e.jsx(ce,{className:"h-4 w-4 mr-2 text-green-500"}),"Additional Notes"]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg min-h-[120px] whitespace-pre-wrap",children:s.notes?e.jsx("p",{className:"text-gray-800",children:s.notes}):e.jsx("p",{className:"text-gray-500 italic",children:"No additional notes provided"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-md font-medium flex items-center",children:[e.jsx(oa,{className:"h-4 w-4 mr-2 text-green-500"}),"Healthcare Team"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(ea,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Doctor"}),e.jsx("p",{className:"text-gray-800",children:((ne=s.assignedDoctors)==null?void 0:ne.primaryName)||"Not Assigned"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Doctor who conducted consultation"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-full",children:e.jsx(me,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Pharmacist"}),e.jsx("p",{className:"text-gray-800",children:s.pharmacistName||p.displayName||"You"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Assigned for final review"})]})]})]}),e.jsxs("h3",{className:"text-md font-medium flex items-center pt-2",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2 text-green-500"}),"Case Timeline"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(De,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Case Created"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.createdAtFormatted})]})]}),s.doctorCompletedAt&&e.jsxs("div",{className:"flex items-start space-x-3 mt-4",children:[e.jsx("div",{className:`p-2 rounded-full ${s.isIncomplete?"bg-red-100":"bg-blue-100"}`,children:s.isIncomplete?e.jsx(_e,{className:`h-4 w-4 ${s.isIncomplete?"text-red-600":"text-blue-600"}`}):e.jsx(oe,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.isIncomplete?"Doctor Marked Incomplete":"Doctor Completion"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.doctorCompletedAtFormatted}),s.doctorCompletedByName&&e.jsxs("p",{className:"text-sm text-gray-500",children:["by ",s.doctorCompletedByName]})]})]}),s.pharmacistCompletedAt&&e.jsxs("div",{className:"flex items-start space-x-3 mt-4",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-full",children:e.jsx(oe,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Pharmacist Completion"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.pharmacistCompletedAtFormatted}),s.pharmacistCompletedByName&&e.jsxs("p",{className:"text-sm text-gray-500",children:["by ",s.pharmacistCompletedByName]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-4",children:[!s.pharmacistCompleted&&!s.isIncomplete&&s.doctorCompleted&&!z&&e.jsxs(b,{onClick:()=>U(s.id),disabled:z||!s.doctorCompleted,className:"w-full bg-amber-600 hover:bg-amber-700 flex items-center justify-center",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Mark as Incomplete"]}),!s.pharmacistCompleted&&!s.isIncomplete&&e.jsx(b,{onClick:()=>g(s.id),disabled:z||!s.doctorCompleted,className:"w-full bg-green-600 hover:bg-green-700 flex items-center justify-center",children:z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),s.doctorCompleted?"Complete Pharmacist Review":"Waiting for Doctor Completion"]})}),s.isIncomplete&&e.jsx("div",{className:"bg-red-50 border border-red-200 p-3 rounded-md",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium flex items-center",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"This case was marked as incomplete by the doctor and requires no further action."]})})]})]})]})})]}):e.jsxs(aa,{defaultValue:L,onValueChange:te,className:"w-full",children:[e.jsxs(sa,{className:"grid grid-cols-2",children:[e.jsx(He,{value:"availability",className:L==="availability"?"bg-green-100 text-green-800":"",children:"Availability"}),e.jsxs(He,{value:"active",className:L==="active"?"bg-green-100 text-green-800":"",children:["Pending Review (",M.length,")"]})]}),e.jsx(Oe,{value:"availability",className:"mt-6",children:e.jsx(da,{currentUser:p})}),e.jsx(Oe,{value:"active",className:"mt-6",children:e.jsxs(ve,{className:"border border-gray-100 shadow-md",children:[e.jsxs(Ce,{className:"bg-gray-50 pb-4",children:[e.jsxs(we,{className:"text-lg flex items-center",children:[e.jsx(ta,{className:"h-5 w-5 text-green-600 mr-2"}),"Cases Pending Pharmacist Review"]}),e.jsx(d,{className:"bg-amber-100 text-amber-800 border-amber-200",children:"Reminder: Remember to start recording when joining the case"})]}),e.jsx(Ae,{className:"p-0",children:M.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"bg-green-50 p-4 rounded-full",children:e.jsx(me,{className:"h-8 w-8 text-green-300"})}),e.jsx("p",{className:"text-lg",children:"No cases pending your review."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cases that doctors have completed will appear here for your review."})]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($e,{children:[e.jsx(Ve,{className:"bg-gray-50",children:e.jsxs(de,{children:[e.jsx(y,{className:"font-semibold",children:"Patients"}),e.jsx(y,{className:"font-semibold",children:"EMRs"}),e.jsx(y,{className:"font-semibold",children:"Complaints"}),e.jsx(y,{className:"font-semibold",children:"Contact Info"}),e.jsx(y,{className:"font-semibold",children:"Clinic"}),e.jsx(y,{className:"font-semibold",children:"Doctor"}),e.jsx(y,{className:"font-semibold",children:"Completed"}),e.jsx(y,{className:"font-semibold",children:"Actions"})]})}),e.jsx(Qe,{children:M.map(a=>{var t;return e.jsxs(de,{className:"hover:bg-gray-50",children:[e.jsx(v,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[Array.isArray(a.patientNames)?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-400 mr-2"}),a.patientNames[0],a.patientCount>1&&e.jsxs(d,{variant:"outline",className:"ml-2 text-xs",children:["+",a.patientCount-1," more"]})]})}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-400 mr-2"}),a.patientName,je(a)&&e.jsxs(d,{variant:"outline",className:"ml-2 text-xs cursor-pointer hover:bg-green-50",onClick:()=>Re(a.batchTimestamp.toString()),children:[e.jsx(ze,{className:"h-3 w-3 mr-1"}),"Batch (",I(a),")"]})]}),a.batchCreated&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Patient ",a.batchIndex+1," of"," ",a.batchSize]})]})}),e.jsx(v,{children:Array.isArray(a.emrNumbers)?e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{children:a.emrNumbers[0]}),a.emrNumbers.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",a.emrNumbers.length-1," more"]})]}):a.emrNumber}),e.jsx(v,{className:"max-w-[150px] truncate",children:Array.isArray(a.chiefComplaints)?e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{className:"truncate",children:a.chiefComplaints[0]}),a.chiefComplaints.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",a.chiefComplaints.length-1," ","more"]})]}):a.chiefComplaint}),e.jsx(v,{children:a.consultationType==="tele"?e.jsx(b,{asChild:!0,className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{le(a)},children:e.jsxs("a",{href:a.contactInfo,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center",children:[e.jsx(ra,{className:"h-4 w-4 mr-2"})," Join"]})}):e.jsx(b,{asChild:!0,className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{le(a)},children:e.jsxs("a",{href:`tel:${a.contactInfo}`,className:"flex items-center justify-center",children:[e.jsx(ia,{className:"h-4 w-4 mr-2"})," Call Patient"]})})}),e.jsx(v,{children:a.clinicName}),e.jsx(v,{children:((t=a.assignedDoctors)==null?void 0:t.primaryName)||"Unknown"}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(De,{className:"h-3.5 w-3.5 text-gray-400 mr-1.5"}),a.doctorCompletedAt?new Date(a.doctorCompletedAt.toDate()).toLocaleDateString():"Not done yet"]})}),e.jsx(v,{children:e.jsx("div",{className:"flex gap-2",children:e.jsxs(b,{size:"sm",onClick:()=>r(a),className:"flex items-center bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Review Case"]})})})]},a.id)})})]})})})]})})]}),e.jsx(ke,{open:re.open,onOpenChange:a=>R({...re,open:a}),children:e.jsxs(Se,{className:"sm:max-w-3xl",children:[e.jsxs(Pe,{children:[e.jsxs(Te,{className:"flex items-center",children:[e.jsx(ze,{className:"h-5 w-5 text-green-500 mr-2"}),"Batch Cases"]}),e.jsx(Be,{children:"All patients created in the same batch"})]}),e.jsxs("div",{className:"mt-4 border-t border-b border-gray-100 py-4",children:[e.jsxs("div",{className:"flex items-center mb-4 space-x-2",children:[e.jsx(la,{className:"h-4 w-4 text-green-500"}),e.jsx("p",{className:"text-sm text-gray-600",children:"These cases were created together in the same batch and share the same contact information."})]}),e.jsx("div",{className:"overflow-x-auto max-h-[400px]",children:e.jsxs($e,{children:[e.jsx(Ve,{className:"bg-gray-50",children:e.jsxs(de,{children:[e.jsx(y,{className:"font-semibold",children:"Patient"}),e.jsx(y,{className:"font-semibold",children:"EMR"}),e.jsx(y,{className:"font-semibold",children:"Complaint"}),e.jsx(y,{className:"font-semibold",children:"Status"}),e.jsx(y,{className:"font-semibold",children:"Actions"})]})}),e.jsx(Qe,{children:re.cases.map(a=>e.jsxs(de,{className:"hover:bg-gray-50",children:[e.jsx(v,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-400 mr-2"}),a.patientName]})}),e.jsx(v,{children:a.emrNumber}),e.jsx(v,{className:"max-w-[200px] truncate",children:a.chiefComplaint}),e.jsx(v,{children:e.jsx(d,{className:a.status==="completed"?"bg-green-100 text-green-800":a.status==="doctor_completed"?"bg-amber-100 text-amber-800":a.status==="doctor_incomplete"||a.status==="pharmacist_incomplete"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:T(a.status)})}),e.jsx(v,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(b,{variant:"outline",size:"sm",className:"flex items-center text-green-600 border-green-200 hover:bg-green-50",onClick:()=>{R({open:!1,cases:[],batchTimestamp:null}),r(a)},children:[e.jsx(ce,{className:"h-4 w-4 mr-1"})," View"]}),a.doctorCompleted&&!a.pharmacistCompleted&&!a.isIncomplete&&e.jsxs(b,{variant:"outline",size:"sm",className:"flex items-center text-green-600 border-green-200 hover:bg-green-50",onClick:()=>{R({open:!1,cases:[],batchTimestamp:null}),g(a.id)},children:[e.jsx(oe,{className:"h-4 w-4 mr-1"})," Complete"]})]})})]},a.id))})]})})]}),e.jsx(Fe,{children:e.jsx(b,{variant:"outline",onClick:()=>R({open:!1,cases:[],batchTimestamp:null}),children:"Close"})})]})})]})};export{pa as default};
