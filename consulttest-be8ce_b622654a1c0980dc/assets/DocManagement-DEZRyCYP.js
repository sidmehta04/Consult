import{r as l,j as e,C as he,a as ue,b as be,n as pe,f as ge,A as Ye,g as Ke,h as Xe,B as i,e as c,U as We,Y as _e,X as Ue,$ as fe,a0 as ye,a1 as ve,a2 as Ce,a3 as we,L as $e,a5 as Ie,a4 as Ae,p as V,q as D,t as ne,u as te,v as re,w as C,x as es,s as le,H as z,i as Y,F as se,P as ze,_ as xe,Z as ae,V as Ve,a6 as ss,a7 as as,a8 as Re,a9 as Ee,d as ts,T as Fe,M as Me,N as K,O as h,Q as Le,W as m,m as rs,z as Je}from"./index-COWPSwuG.js";import{U as Ge,a as je,C as Ne,L as Qe}from"./user-x-Ca6qzlEV.js";import{f as X,P as qe}from"./format-B6mXiQzZ.js";import{A as ls,B as ns}from"./building-DYKYV5F4.js";const is=({currentUser:b})=>{const[n,De]=l.useState("available"),[ie,ce]=l.useState(!0),[L,H]=l.useState(!1),[W,N]=l.useState(""),[a,J]=l.useState([]),[Q,q]=l.useState(!1),[O,P]=l.useState(""),[G,Z]=l.useState(!1),[w,Se]=l.useState(30),[R,ke]=l.useState([]),[oe,_]=l.useState("");l.useEffect(()=>{const t=async()=>{try{const p=V(D,"users",b.uid);return ne(p,M=>{if(M.exists()){const A=M.data();De(A.availabilityStatus||"available"),ke(A.availabilityHistory||[])}ce(!1)})}catch(p){console.error("Error fetching doctor status:",p),N("Failed to load availability status"),ce(!1)}},E=async()=>{try{const p=te(re(D,"cases"),C("assignedDoctors.primary","==",b.uid),C("doctorCompleted","==",!1),C("isIncomplete","==",!1));return ne(p,M=>{const A=[];M.forEach($=>{A.push({id:$.id,...$.data()})}),J(A)})}catch(p){console.error("Error fetching active cases:",p)}};return t(),E(),()=>{}},[b.uid]);const U=async(t,E="",p=null)=>{try{H(!0);const F=es(),M=V(D,"users",b.uid),A=await le(M);if(!A.exists())throw new Error("Doctor profile not found");const de=A.data().availabilityHistory||[],I={previousStatus:n,newStatus:t,changedAt:new Date,reason:E,casesNo:a.length};if(p){I.expectedDuration=p;const ee=new Date;ee.setMinutes(ee.getMinutes()+p),I.expectedReturnTime=ee}const Be=[I,...de];let me={};t==="on_break"&&(me={breakStartedAt:F,breakDuration:p}),await z(M,{availabilityStatus:t,lastStatusUpdate:F,availabilityHistory:Be,...me}),q(!1),Z(!1),P(""),H(!1)}catch(F){console.error("Error updating status:",F),N("Failed to update availability status"),H(!1)}},f=t=>{t==="unavailable"?(_("unavailable"),q(!0)):t==="on_break"?(_("break"),Z(!0)):U(t)},Te=()=>{switch(n){case"available":return e.jsx(i,{className:"bg-green-100 text-green-800 border-green-200",children:"Available"});case"busy":return e.jsx(i,{className:"bg-red-100 text-red-800 border-red-200",children:"Busy"});case"unavailable":return e.jsx(i,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"Unavailable"});case"on_break":return e.jsx(i,{className:"bg-amber-100 text-amber-800 border-amber-200",children:"On Break"});default:return e.jsx(i,{variant:"outline",children:"Unknown"})}},Pe=()=>{switch(n){case"available":return"bg-green-100 text-green-800 border-green-200";case"busy":return"bg-red-100 text-red-800 border-red-200";case"unavailable":return"bg-gray-100 text-gray-800 border-gray-200";case"on_break":return"bg-amber-100 text-amber-800 border-amber-200";default:return""}};return l.useEffect(()=>{n==="available"&&a.length>=10&&U("busy","Automatically marked as busy due to high case load")},[a,n]),ie?e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(he,{className:"border border-gray-100 shadow-md",children:[e.jsx(ue,{className:`pb-4 ${Pe()}`,children:e.jsxs(be,{className:"flex items-center text-xl",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Availability Management"]})}),e.jsxs(ge,{className:"pt-6",children:[W&&e.jsxs(Ye,{variant:"destructive",className:"mb-4",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx(Xe,{children:W})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Current Status"}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${n==="available"?"bg-green-500":n==="busy"?"bg-red-500":n==="unavailable"?"bg-gray-500":"bg-amber-500"}`}),e.jsxs("p",{className:"font-medium",children:["You are currently ",Te()]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("p",{className:"mr-2 text-sm text-gray-500",children:["Active Cases:",e.jsx("span",{className:`ml-1 font-medium ${a.length>=10?"text-red-600":"text-green-600"}`,children:a.length})]}),e.jsx(i,{className:a.length>=10?"bg-red-100 text-red-800":"bg-green-100 text-green-800",children:a.length>=10?"High Load":"Available"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(c,{variant:n==="available"?"default":"outline",className:n==="available"?"bg-green-600 hover:bg-green-700":"",onClick:()=>f("available"),children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Available"]}),e.jsxs(c,{variant:n==="busy"?"default":"outline",className:n==="busy"?"bg-red-600 hover:bg-red-700":"",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Busy"]}),e.jsxs(c,{variant:n==="unavailable"?"default":"outline",className:n==="unavailable"?"bg-gray-600 hover:bg-gray-700":"",onClick:()=>f("unavailable"),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Unavailable"]}),e.jsxs(c,{variant:n==="on_break"?"default":"outline",className:n==="on_break"?"bg-amber-600 hover:bg-amber-700":"",onClick:()=>f("on_break"),children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Lunch Break"]})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(_e,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Status Explanation"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-gray-600",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-green-600",children:"Available:"})," Ready to accept new cases"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-red-600",children:"Busy:"})," Already handling maximum cases"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Unavailable:"})," Off duty or not working"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-amber-600",children:"Lunch Break:"})," Temporarily unavailable"]})]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-md font-medium flex items-center",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2 text-blue-500"}),"Recent Status Changes"]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-[300px] overflow-y-auto",children:R.length===0?e.jsx("p",{className:"text-gray-500 text-center",children:"No status changes recorded"}):e.jsx("div",{className:"space-y-3",children:R.map((t,E)=>e.jsxs("div",{className:"bg-white p-3 rounded border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${t.newStatus==="available"?"bg-green-500":t.newStatus==="busy"?"bg-red-500":t.newStatus==="unavailable"?"bg-gray-500":"bg-amber-500"}`}),e.jsx("span",{className:"font-medium",children:t.newStatus==="available"?"Available":t.newStatus==="busy"?"Busy":t.newStatus==="unavailable"?"Unavailable":"On Break"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:t.changedAt instanceof Date?X(t.changedAt,"MMM d, h:mm a"):"Recently"})]}),t.reason&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Reason: ",t.reason]}),t.expectedDuration&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Duration: ",t.expectedDuration," minutes"]}),t.previousStatus&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Previous: ",t.previousStatus==="available"?"Available":t.previousStatus==="busy"?"Busy":t.previousStatus==="unavailable"?"Unavailable":"On Break"]})]},E))})})]})]})]})]}),e.jsx(fe,{open:Q,onOpenChange:q,children:e.jsxs(ye,{className:"sm:max-w-md",children:[e.jsxs(ve,{children:[e.jsxs(Ce,{className:"flex items-center",children:[e.jsx(je,{className:"h-5 w-5 text-gray-600 mr-2"}),"Mark as Unavailable"]}),e.jsx(we,{children:"Please provide a reason for marking yourself as unavailable."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx($e,{htmlFor:"unavailableReason",children:"Reason for unavailability"}),e.jsx(Ie,{id:"unavailableReason",value:O,onChange:t=>P(t.target.value),placeholder:"e.g., Taking time off, personal emergency, etc.",className:"min-h-[100px]"})]})}),e.jsxs(Ae,{className:"sm:justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(c,{onClick:()=>U("unavailable",O),disabled:L||!O.trim(),className:"bg-gray-600 hover:bg-gray-700",children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"})," Mark as Unavailable"]})})]})]})}),e.jsx(fe,{open:G,onOpenChange:Z,children:e.jsxs(ye,{className:"sm:max-w-md",children:[e.jsxs(ve,{children:[e.jsxs(Ce,{className:"flex items-center",children:[e.jsx(Ne,{className:"h-5 w-5 text-amber-500 mr-2"}),"Lunch Break"]}),e.jsx(we,{children:"Please select how long you'll be on break."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx($e,{htmlFor:"breakDuration",children:"Break Duration (minutes)"}),e.jsx("div",{className:"flex space-x-2",children:[15,30,45,60].map(t=>e.jsx(c,{type:"button",variant:w===t?"default":"outline",className:w===t?"bg-amber-600 hover:bg-amber-700":"",onClick:()=>Se(t),children:t},t))}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:['Your status will be marked as "On Break" for ',w," minutes."]})]})}),e.jsxs(Ae,{className:"sm:justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),e.jsx(c,{onClick:()=>U("on_break",`Taking a ${w} minute break`,w),disabled:L,className:"bg-amber-600 hover:bg-amber-700",children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"})," Start Break"]})})]})]})})]})},xs=({currentUser:b})=>{var He;const[n,De]=l.useState([]),[ie,ce]=l.useState([]),[L,H]=l.useState(!0),[W,N]=l.useState(""),[a,J]=l.useState(null),[Q,q]=l.useState("availability"),[O,P]=l.useState(!1),[G,Z]=l.useState("connected"),[w,Se]=l.useState({availabilityStatus:"available",lastUpdate:null,history:[]}),[R,ke]=l.useState({}),[oe,_]=l.useState({open:!1,cases:[],batchTimestamp:null}),[U,f]=l.useState(!1),[Te,Pe]=l.useState([]),[t,E]=l.useState(""),p=async(s,r=3)=>{let x;for(let g=0;g<r;g++)try{return await s()}catch(o){console.error(`Operation failed (attempt ${g+1}/${r}):`,o),x=o,await new Promise(j=>setTimeout(j,Math.pow(2,g)*100))}throw x};l.useEffect(()=>{const s=async()=>{try{n.length>=10&&w.status==="available"?(console.log("Auto-updating status to busy - case count:",n.length),await de("busy","Automatically marked as busy due to high case load")):n.length<10&&w.status==="busy"&&(console.log("Auto-updating status to available - case count:",n.length),await de("available","Automatically marked as available due to reduced case load"))}catch(r){console.error("Error in auto status update:",r)}};n.length!==void 0&&w.status&&!L&&s()},[n.length,w.status,L,b.uid]),l.useEffect(()=>{const s=async()=>{try{const o=V(D,"users",b.uid);return ne(o,S=>{if(S.exists()){const k=S.data();Se({status:k.availabilityStatus||"available",lastUpdate:k.lastStatusUpdate,history:k.availabilityHistory||[]})}})}catch(o){console.error("Error fetching doctor status:",o)}},r=async()=>{try{const o=te(re(D,"cases"),C("assignedDoctors.primary","==",b.uid),C("doctorCompleted","==",!1)),j=te(re(D,"cases"),C("assignedDoctors.primary","==",b.uid),C("doctorCompleted","==",!0),C("pharmacistCompleted","==",!1),C("status","==","doctor_completed")),S=ne(o,u=>{const v=[],T={};u.forEach(y=>{const d=y.data();if(d.batchCreated&&d.batchTimestamp){const B=d.batchTimestamp.toString();T[B]||(T[B]=[]),T[B].push({id:y.id,...d,createdAtFormatted:d.createdAt&&typeof d.createdAt.toDate=="function"?X(d.createdAt.toDate(),"PPpp"):"Not available",doctorCompletedAtFormatted:d.doctorCompletedAt?X(d.doctorCompletedAt.toDate(),"PPpp"):null})}v.push({id:y.id,...d,createdAtFormatted:d.createdAt&&typeof d.createdAt.toDate=="function"?X(d.createdAt.toDate(),"PPpp"):"Not available"})}),v.sort((y,d)=>{var B,Oe;return((B=y.createdAt)==null?void 0:B.toDate())-((Oe=d.createdAt)==null?void 0:Oe.toDate())}),De(v),ke(T),H(!1)},u=>{console.error("Active cases listener error:",u),N("Connection lost. Reconnecting..."),setTimeout(()=>{N(""),r()},2e3)}),k=ne(j,u=>{const v=[];u.forEach(T=>{const y=T.data();v.push({id:T.id,...y,createdAtFormatted:y.createdAt?X(y.createdAt.toDate(),"PPpp"):"",doctorCompletedAtFormatted:y.doctorCompletedAt?X(y.doctorCompletedAt.toDate(),"PPpp"):""})}),v.sort((T,y)=>{var d,B;return((d=y.doctorCompletedAt)==null?void 0:d.toDate())-((B=T.doctorCompletedAt)==null?void 0:B.toDate())}),ce(v),Pe(v),H(!1)},u=>{console.error("Completed cases listener error:",u),N("Connection lost. Reconnecting..."),setTimeout(()=>{N(""),r()},2e3)});return()=>{S(),k()}}catch(o){console.error("Error setting up listeners:",o),N("Failed to load cases"),H(!1)}},x=s(),g=r();return()=>{typeof x=="function"&&x(),typeof g=="function"&&g()}},[b.uid]);const F=s=>{J(s)},M=s=>{J(s)},A=async s=>{try{const r=new Date,x=V(D,"cases",s.id),g=await le(x);if(!g.exists())throw new Error("Case not found");const o=g.data();if(o.doctorJoined){console.warn("Doctor has already joined this case.");return}const j={doctorJoined:r};if(o.batchCode){const S=te(re(D,"cases"),C("batchCode","==",o.batchCode));(await Je(S)).forEach(async u=>{const v=u.ref;await p(()=>z(v,j))})}else await p(()=>z(x,j))}catch{console.error("Error setting doctor joining time: ",err)}},$=async(s,r=!1)=>{if(s){if(r&&!t){f(!0);return}try{P(!0);const x=new Date,g=V(D,"cases",s),o=await le(g);if(!o.exists())throw new Error("Case not found");const j=o.data(),S=j.version||0;if(!r&&!j.pharmacistId){N("Cannot complete this case as no pharmacist has been assigned yet."),P(!1),f(!1);return}if(r){const k={doctorCompleted:!0,doctorCompletedAt:x,doctorCompletedBy:b.uid,doctorCompletedByName:b.displayName||"Doctor",status:"doctor_incomplete",isIncomplete:!0,incompleteReason:t,inPharmacistPendingReview:!1,version:S+1};try{await p(()=>z(g,k))}catch(u){console.error("Error updating case after retries:",u),N("Failed to update case after multiple attempts. Please try again."),P(!1),f(!1);return}if(j.pharmacistId){const u=V(D,"users",j.pharmacistId),v=await le(u);if(v.exists()){const T=te(re(D,"cases"),C("pharmacistId","==",j.pharmacistId),C("pharmacistCompleted","==",!1),C("isIncomplete","!=",!0)),d=(await Je(T)).size;v.data().availabilityStatus==="busy"&&d<10&&await z(u,{availabilityStatus:"available",lastStatusUpdate:x,autoStatusChange:!0})}}}else{if(j.doctorCompleted){N("This case has already been completed by a doctor."),P(!1),f(!1);return}const k={doctorCompleted:!0,doctorCompletedAt:x,doctorCompletedBy:b.uid,doctorCompletedByName:b.displayName||"Doctor",status:"doctor_completed",isIncomplete:!1,inPharmacistPendingReview:!0,version:S+1};try{await p(()=>z(g,k))}catch(u){console.error("Error updating case after retries:",u),N("Failed to update case after multiple attempts. Please try again."),P(!1),f(!1);return}}J(null),P(!1),f(!1),E("")}catch(x){console.error("Error completing case:",x),N("Failed to complete case"),P(!1),f(!1)}}},de=async(s,r="")=>{try{const x=new Date,g=V(D,"users",b.uid),o=await le(g);if(!o.exists())throw new Error("Doctor profile not found");const S=o.data().availabilityHistory||[],u=[{previousStatus:w.status,newStatus:s,changedAt:x,reason:r},...S];await z(g,{availabilityStatus:s,lastStatusUpdate:x,availabilityHistory:u})}catch(x){console.error("Error updating status:",x),N("Failed to update availability status")}},I=s=>{switch(s){case"pending":return e.jsx(i,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Pending"});case"doctor_completed":return e.jsx(i,{className:"bg-green-100 text-green-800 border-green-200",children:"Doctor Completed"});case"doctor_incomplete":return e.jsx(i,{className:"bg-red-100 text-red-800 border-red-200",children:"Marked Incomplete by Doctor"});case"pharmacist_incomplete":return e.jsx(i,{className:"bg-red-100 text-red-800 border-red-200",children:"Marked Incomplete by Pharmacist"});case"completed":return e.jsx(i,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"Fully Completed"});default:return e.jsx(i,{variant:"outline",children:"Unknown"})}},Be=()=>{switch(w.status){case"available":return e.jsxs(i,{className:"bg-green-100 text-green-800 border-green-200",children:[e.jsx(Ge,{className:"h-3.5 w-3.5 mr-1.5"}),"Available"]});case"busy":return e.jsxs(i,{className:"bg-red-100 text-red-800 border-red-200",children:[e.jsx(We,{className:"h-3.5 w-3.5 mr-1.5"}),"Busy"]});case"unavailable":return e.jsxs(i,{className:"bg-gray-100 text-gray-800 border-gray-200",children:[e.jsx(je,{className:"h-3.5 w-3.5 mr-1.5"}),"Unavailable"]});case"on_break":return e.jsxs(i,{className:"bg-amber-100 text-amber-800 border-amber-200",children:[e.jsx(Ne,{className:"h-3.5 w-3.5 mr-1.5"}),"On Break"]});default:return e.jsx(i,{variant:"outline",children:"Unknown"})}};if(L)return e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})});const me=s=>{R[s]&&_({open:!0,cases:R[s],batchTimestamp:s})},ee=s=>{if(s.batchCreated&&s.batchTimestamp){const r=s.batchTimestamp.toString();return R[r]&&R[r].length>1}return!1},Ze=s=>{if(s.batchCreated&&s.batchTimestamp){const r=s.batchTimestamp.toString();return R[r]?R[r].length:0}return 0};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(pe,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Doctor Dashboard"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-2",children:"Status:"}),Be(),e.jsx("span",{className:"text-sm text-gray-500 ml-4 mr-2",children:"Active Cases:"}),e.jsxs(i,{className:n.length>=10?"bg-red-100 text-red-800":"bg-green-100 text-green-800",children:[n.length,"/10"]})]})]})]}),a&&e.jsxs(c,{variant:"outline",onClick:()=>J(null),className:"flex items-center border-blue-200 text-blue-600 hover:bg-blue-50",children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})]}),(W||G==="reconnecting")&&e.jsxs(Ye,{variant:G==="reconnecting"?"default":"destructive",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx(Xe,{children:G==="reconnecting"?"Reconnecting to server...":W})]}),a?e.jsxs(he,{className:"border border-gray-100 shadow-md",children:[e.jsxs(ue,{className:"bg-blue-50 pb-4 flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(be,{className:"flex items-center text-xl",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-600 mr-2"}),Array.isArray(a.patientNames)?e.jsxs(e.Fragment,{children:[a.patientNames[0],a.patientCount>1&&e.jsxs(i,{variant:"outline",className:"ml-2 text-xs bg-blue-50 text-blue-600",children:["+",a.patientCount-1," more"]})]}):a.patientName]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Total Patients:"," ",Array.isArray(a.patientNames)?a.patientCount:1]})]}),e.jsx(i,{className:"text-sm bg-blue-100 text-blue-800 border-blue-200",children:a.consultationType==="tele"?"Tele Consultation":"Audio Consultation"})]}),e.jsx(ge,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-md font-medium flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-blue-500"}),"Patient Details"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[Array.isArray(a.patientNames)?e.jsxs("div",{className:"mb-4 border-b pb-3 border-gray-200",children:[e.jsxs("h4",{className:"font-medium text-blue-700 mb-2",children:["Patient Information (",a.patientCount,")"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-3",children:a.patientNames.map((s,r)=>e.jsxs("div",{className:"bg-white p-3 rounded border border-gray-100",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsxs("span",{className:"font-medium text-gray-600 w-28",children:["Patient #",r+1,":"]}),e.jsx("span",{className:"text-gray-800",children:s})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"EMR:"}),e.jsx("span",{className:"text-gray-800",children:a.emrNumbers[r]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Complaint:"}),e.jsx("span",{className:"text-gray-800",children:a.chiefComplaints[r]})]})]},r))})]}):e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Chief Complaint:"}),e.jsx("span",{className:"text-gray-800",children:a.chiefComplaint})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Clinic:"}),e.jsx("span",{className:"text-gray-800",children:a.clinicName})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Created:"}),e.jsx("span",{className:"text-gray-800",children:a.createdAtFormatted})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Created By:"}),e.jsx("span",{className:"text-gray-800",children:a.createdByName||"Unknown"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium text-gray-600 w-28",children:"Status:"}),e.jsx("span",{children:I(a.status)})]})]}),e.jsxs("h3",{className:"text-md font-medium flex items-center pt-2",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-blue-500"}),"Additional Notes"]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg min-h-[120px] whitespace-pre-wrap",children:a.notes?e.jsx("p",{className:"text-gray-800",children:a.notes}):e.jsx("p",{className:"text-gray-500 italic",children:"No additional notes provided"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-md font-medium flex items-center",children:[e.jsx(ns,{className:"h-4 w-4 mr-2 text-blue-500"}),"Healthcare Team"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Doctor"}),e.jsx("p",{className:"text-gray-800",children:((He=a.assignedDoctors)==null?void 0:He.primaryName)||b.displayName||"You"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Primary Assigned Doctor"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-full",children:e.jsx(ze,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Pharmacist"}),e.jsx("p",{className:"text-gray-800",children:a.pharmacistName||"Not assigned"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Will review after doctor completion"})]})]})]}),e.jsxs("h3",{className:"text-md font-medium flex items-center pt-2",children:[e.jsx(_e,{className:"h-4 w-4 mr-2 text-blue-500"}),"Case Timeline"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(Ue,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Case Created"}),e.jsx("p",{className:"text-sm text-gray-500",children:a.createdAtFormatted})]})]}),a.doctorCompletedAt&&e.jsxs("div",{className:"flex items-start space-x-3 mt-4",children:[e.jsx("div",{className:`p-2 rounded-full ${a.isIncomplete?"bg-red-100":"bg-green-100"}`,children:a.isIncomplete?e.jsx(xe,{className:"h-4 w-4 text-red-600"}):e.jsx(ae,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.isIncomplete?"Marked as Incomplete":"Doctor Completion"}),e.jsx("p",{className:"text-sm text-gray-500",children:a.doctorCompletedAtFormatted}),a.doctorCompletedByName&&e.jsxs("p",{className:"text-sm text-gray-500",children:["by ",a.doctorCompletedByName]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 pt-4",children:[a.consultationType==="tele"?e.jsx(c,{asChild:!0,className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{A(a)},children:e.jsxs("a",{href:a.contactInfo,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"})," Join Google Meet Session"]})}):e.jsx(c,{asChild:!0,className:"w-full bg-blue-600 hover:bg-blue-700",children:e.jsxs("a",{href:`tel:${a.contactInfo}`,className:"flex items-center justify-center",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"})," Call Patient"]})}),!a.doctorCompleted&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>$(a.id,!1),disabled:O,className:"w-full bg-green-600 hover:bg-green-700 flex items-center justify-center",children:O&&!U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"})," Mark Consultation as Complete"]})}),e.jsxs(c,{onClick:()=>f(!0),disabled:O,className:"w-full bg-red-600 hover:bg-red-700 flex items-center justify-center",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"})," Mark as Incomplete"]})]})]})]})]})})]}):e.jsxs(ss,{defaultValue:Q,onValueChange:q,className:"w-full",children:[e.jsxs(as,{className:"grid grid-cols-3",children:[e.jsx(Re,{value:"availability",className:Q==="availability"?"bg-blue-100 text-blue-800":"",children:"Availability Management"}),e.jsxs(Re,{value:"active",className:Q==="active"?"bg-blue-100 text-blue-800":"",children:["Active Cases (",n.length,")"]}),e.jsxs(Re,{value:"completed",className:Q==="completed"?"bg-green-100 text-green-800":"",children:["Pending Pharmacy (",ie.length,")"]})]}),e.jsx(Ee,{value:"availability",className:"mt-6",children:e.jsx(is,{currentUser:b})}),e.jsx(Ee,{value:"active",className:"mt-6",children:e.jsxs(he,{className:"border border-gray-100 shadow-md",children:[e.jsx(ue,{className:"bg-gray-50 pb-4",children:e.jsxs(be,{className:"text-lg flex items-center",children:[e.jsx(ts,{className:"h-5 w-5 text-blue-600 mr-2"}),"Active Cases"]})}),e.jsx(ge,{className:"p-0",children:n.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-full",children:e.jsx(pe,{className:"h-8 w-8 text-blue-300"})}),e.jsx("p",{className:"text-lg",children:"No active cases assigned to you currently."}),e.jsx("p",{className:"text-sm text-gray-500",children:"New cases will appear here when they are assigned to you."})]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(Me,{className:"bg-gray-50",children:e.jsxs(K,{children:[e.jsx(h,{className:"font-semibold",children:"Patients"}),e.jsx(h,{className:"font-semibold",children:"EMRs"}),e.jsx(h,{className:"font-semibold",children:"Complaints"}),e.jsx(h,{className:"font-semibold",children:"Clinic"}),e.jsx(h,{className:"font-semibold",children:"Type"}),e.jsx(h,{className:"font-semibold",children:"Created"}),e.jsx(h,{className:"font-semibold",children:"Actions"})]})}),e.jsx(Le,{children:n.map(s=>{var r;return e.jsxs(K,{className:"hover:bg-gray-50",children:[e.jsx(m,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[Array.isArray(s.patientNames)?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-400 mr-2"}),s.patientNames[0],s.patientCount>1&&e.jsxs(i,{variant:"outline",className:"ml-2 text-xs",children:["+",s.patientCount-1," more"]})]})}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-400 mr-2"}),s.patientName,ee(s)&&e.jsxs(i,{variant:"outline",className:"ml-2 text-xs cursor-pointer hover:bg-blue-50",onClick:()=>me(s.batchTimestamp.toString()),children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),"Batch (",Ze(s),")"]})]}),s.batchCreated&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Patient ",s.batchIndex+1," of"," ",s.batchSize]})]})}),e.jsx(m,{children:Array.isArray(s.emrNumbers)?e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{children:s.emrNumbers[0]}),s.emrNumbers.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.emrNumbers.length-1," more"]})]}):s.emrNumber}),e.jsx(m,{className:"max-w-[150px] truncate",children:Array.isArray(s.chiefComplaints)?e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{className:"truncate",children:s.chiefComplaints[0]}),s.chiefComplaints.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.chiefComplaints.length-1," ","more"]})]}):s.chiefComplaint}),e.jsxs(m,{children:[s.clinicCode??s.clinicName,e.jsx("br",{}),s.manualClinicCode&&s.manualClinicCode]}),e.jsx(m,{children:e.jsx(i,{variant:s.consultationType==="tele"?"default":"outline",className:s.consultationType==="tele"?"bg-indigo-100 text-indigo-800 hover:bg-indigo-100":"",children:s.consultationType==="tele"?"Tele":"Audio"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Ue,{className:"h-3.5 w-3.5 text-gray-400 mr-1.5"}),new Date((r=s.createdAt)==null?void 0:r.toDate()).toLocaleDateString()]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",onClick:()=>F(s),className:"flex items-center bg-blue-600 hover:bg-blue-700",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"View Case"]}),s.consultationType==="tele"?e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{A(s)},className:"flex items-center text-indigo-600 border-indigo-200 hover:bg-indigo-50",asChild:!0,children:e.jsxs("a",{href:s.contactInfo,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"})," Join"]})}):e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{A(s)},className:"flex items-center text-blue-600 border-blue-200 hover:bg-blue-50",asChild:!0,children:e.jsxs("a",{href:`tel:${s.contactInfo}`,children:[e.jsx(qe,{className:"h-4 w-4 mr-1"})," Call"]})})]})})]},s.id)})})]})})})]})}),e.jsx(Ee,{value:"completed",className:"mt-6",children:e.jsxs(he,{className:"border border-gray-100 shadow-md",children:[e.jsx(ue,{className:"bg-gray-50 pb-4",children:e.jsxs(be,{className:"text-lg flex items-center",children:[e.jsx(ze,{className:"h-5 w-5 text-green-600 mr-2"}),"Awaiting Pharmacist Review"]})}),e.jsx(ge,{className:"p-0",children:ie.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"bg-green-50 p-4 rounded-full",children:e.jsx(ae,{className:"h-8 w-8 text-green-300"})}),e.jsx("p",{className:"text-lg",children:"No cases awaiting pharmacist review."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cases you complete will show here until the pharmacist reviews them."})]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(Me,{className:"bg-gray-50",children:e.jsxs(K,{children:[e.jsx(h,{className:"font-semibold",children:"Patients"}),e.jsx(h,{className:"font-semibold",children:"EMRs"}),e.jsx(h,{className:"font-semibold",children:"Complaints"}),e.jsx(h,{className:"font-semibold",children:"Clinic"}),e.jsx(h,{className:"font-semibold",children:"Type"}),e.jsx(h,{className:"font-semibold",children:"Created"}),e.jsx(h,{className:"font-semibold",children:"Actions"})]})}),e.jsx(Le,{children:Te.map(s=>{var r;return e.jsxs(K,{className:"hover:bg-gray-50",children:[e.jsx(m,{className:"font-medium",children:e.jsx("div",{className:"flex flex-col space-y-1",children:Array.isArray(s.patientNames)?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-400 mr-2"}),s.patientNames[0],s.patientCount>1&&e.jsxs(i,{variant:"outline",className:"ml-2 text-xs",children:["+",s.patientCount-1," more"]})]})}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-400 mr-2"}),s.patientName]})})}),e.jsx(m,{children:Array.isArray(s.emrNumbers)?e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{children:s.emrNumbers[0]}),s.emrNumbers.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.emrNumbers.length-1," more"]})]}):s.emrNumber}),e.jsx(m,{className:"max-w-[150px] truncate",children:Array.isArray(s.chiefComplaints)?e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{className:"truncate",children:s.chiefComplaints[0]}),s.chiefComplaints.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.chiefComplaints.length-1," ","more"]})]}):s.chiefComplaint}),e.jsx(m,{children:s.contactInfo}),e.jsx(m,{children:s.clinicName}),e.jsx(m,{children:((r=s.assignedDoctors)==null?void 0:r.primaryName)||"Unknown"}),e.jsx(m,{children:s.doctorCompleted?e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ae,{className:"h-3.5 w-3.5 text-green-500 mr-1.5"}),"Doc Completed",e.jsx("div",{className:"text-xs text-gray-500 ml-1",children:new Date(s.doctorCompletedAt.toDate()).toLocaleDateString()})]}):e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(_e,{className:"h-3.5 w-3.5 text-amber-500 mr-1.5"}),"Awaiting Doctor"]})}),e.jsx(m,{children:e.jsx("div",{className:"flex gap-2",children:e.jsxs(c,{size:"sm",onClick:()=>M(s),className:"flex items-center bg-green-600 hover:bg-green-700",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Review Case"]})})})]},s.id)})})]})})})]})})]}),U&&a&&e.jsx(fe,{open:U,onOpenChange:f,children:e.jsxs(ye,{className:"sm:max-w-md",children:[e.jsxs(ve,{children:[e.jsxs(Ce,{className:"flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 text-red-500 mr-2"}),"Mark Case as Incomplete"]}),e.jsx(we,{children:"Please provide a reason why this case is being marked as incomplete."})]}),e.jsxs("div",{className:"py-3 space-y-2",children:[e.jsxs("label",{htmlFor:"incompleteReason",className:"text-sm font-medium",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"incompleteReason",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Please explain why this case is being marked as incomplete...",value:t,onChange:s=>E(s.target.value),required:!0})]}),e.jsxs(Ae,{className:"sm:justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>{f(!1),E("")},children:"Cancel"}),e.jsxs(c,{onClick:()=>{t.trim()&&$(a.id,!0)},disabled:!t.trim(),className:"bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Mark as Incomplete"]})]})]})}),e.jsx(fe,{open:oe.open,onOpenChange:s=>_({...oe,open:s}),children:e.jsxs(ye,{className:"sm:max-w-3xl",children:[e.jsxs(ve,{children:[e.jsxs(Ce,{className:"flex items-center",children:[e.jsx(Qe,{className:"h-5 w-5 text-blue-500 mr-2"}),"Batch Cases"]}),e.jsx(we,{children:"All patients created in the same batch"})]}),e.jsxs("div",{className:"mt-4 border-t border-b border-gray-100 py-4",children:[e.jsxs("div",{className:"flex items-center mb-4 space-x-2",children:[e.jsx(rs,{className:"h-4 w-4 text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-600",children:"These cases were created together in the same batch and share the same contact information."})]}),e.jsx("div",{className:"overflow-x-auto max-h-[400px]",children:e.jsxs(Fe,{children:[e.jsx(Me,{className:"bg-gray-50",children:e.jsxs(K,{children:[e.jsx(h,{className:"font-semibold",children:"Patient"}),e.jsx(h,{className:"font-semibold",children:"EMR"}),e.jsx(h,{className:"font-semibold",children:"Complaint"}),e.jsx(h,{className:"font-semibold",children:"Status"}),e.jsx(h,{className:"font-semibold",children:"Actions"})]})}),e.jsx(Le,{children:oe.cases.map(s=>e.jsxs(K,{className:"hover:bg-gray-50",children:[e.jsx(m,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-400 mr-2"}),s.patientName]})}),e.jsx(m,{children:s.emrNumber}),e.jsx(m,{className:"max-w-[200px] truncate",children:s.chiefComplaint}),e.jsx(m,{children:e.jsx(i,{className:s.status==="completed"?"bg-green-100 text-green-800":s.status==="doctor_completed"?"bg-blue-100 text-blue-800":s.status==="doctor_incomplete"||s.status==="pharmacist_incomplete"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:getStatusLabel(s.status)})}),e.jsx(m,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",className:"flex items-center text-blue-600 border-blue-200 hover:bg-blue-50",onClick:()=>{_({open:!1,cases:[],batchTimestamp:null}),F(s)},children:[e.jsx(se,{className:"h-4 w-4 mr-1"})," View"]}),!s.doctorCompleted&&e.jsxs(c,{variant:"outline",size:"sm",className:"flex items-center text-green-600 border-green-200 hover:bg-green-50",onClick:()=>{_({open:!1,cases:[],batchTimestamp:null}),$(s.id,!1)},children:[e.jsx(ae,{className:"h-4 w-4 mr-1"})," Complete"]})]})})]},s.id))})]})})]}),e.jsx(Ae,{children:e.jsx(c,{variant:"outline",onClick:()=>_({open:!1,cases:[],batchTimestamp:null}),children:"Close"})})]})})]})};export{xs as default};
