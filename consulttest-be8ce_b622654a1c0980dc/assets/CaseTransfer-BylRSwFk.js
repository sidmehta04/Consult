import{c as le,j as e,C as Te,a as ms,b as fs,aa as es,B,U as xe,f as we,A as re,g as X,h as ne,ab as pe,L as De,ac as hs,I as xs,ad as ps,ae as gs,af as bs,ag as ys,ah as be,e as L,R as Ns,r as n,ai as js,aj as Cs,Z as vs,ak as O,N as ss,W as H,n as G,P as V,i as Ss,al as as,V as Ts,X as ws,Y as Ds,y as ks,q as Q,p as We,x as me,am as Es,o as Ge,_ as ye,an as Ps,ao as Ne,T as Rs,M as As,O as q,Q as Ms,J as _s,K as Ls,$ as $s,a0 as Bs,a1 as Os,a2 as Is,a3 as Fs,a4 as zs,v as je,u as Ce,w as fe,D as Ve,E as ve,t as Se}from"./index-COWPSwuG.js";import{P as Hs,f as Xe}from"./format-B6mXiQzZ.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Qs=le("ArrowRight",qs);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Ws=le("Ellipsis",Us);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ke=le("SquareCheckBig",Gs);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Xs=le("Square",Vs);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ke=le("Zap",Ks),Js=({filteredCasesCount:s,totalCasesCount:a,error:t,success:c,searchTerm:l,setSearchTerm:d,selectedQueue:o,setSelectedQueue:u,selectedClinic:p,setSelectedClinic:i,clinics:N,onRefresh:f,bulkModeActive:y=!1,selectedCount:h=0,transferableCasesCount:x=0})=>e.jsxs(Te,{className:"border border-gray-200",children:[e.jsx(ms,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:e.jsxs(fs,{className:"text-xl flex items-center",children:[e.jsx(es,{className:"h-5 w-5 text-blue-600 mr-2"}),"Case Transfer Management",e.jsxs("div",{className:"ml-2 flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",s," pending cases)"]}),y&&e.jsxs(B,{variant:"secondary",className:"bg-purple-50 text-purple-700 border-purple-200",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Bulk Mode"]}),y&&h>0&&e.jsxs(B,{variant:"default",className:"bg-blue-600 text-white",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),h," selected"]})]}),e.jsxs("div",{className:"ml-auto flex items-center space-x-3",children:[y&&e.jsx("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsxs("span",{children:[x," transferable"]})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse mr-2"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Live Updates"})]})]})]})}),e.jsxs(we,{className:"pt-6",children:[t&&e.jsxs(re,{variant:"destructive",className:"mb-4",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(ne,{children:t})]}),c&&e.jsxs(re,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(pe,{className:"h-4 w-4 text-green-600"}),e.jsx(ne,{className:"text-green-800",children:c})]}),y&&e.jsxs(re,{className:"mb-4 border-purple-200 bg-purple-50",children:[e.jsx(ke,{className:"h-4 w-4 text-purple-600"}),e.jsxs(ne,{className:"text-purple-800",children:[e.jsx("strong",{children:"Bulk Transfer Mode Active:"})," Select multiple cases from the doctor queue to transfer them all at once. Only cases currently in the doctor queue can be transferred.",h>0&&e.jsxs("span",{className:"block mt-1",children:[e.jsx("strong",{children:h})," cases selected for bulk transfer."]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(De,{htmlFor:"search",className:"text-sm font-medium mb-2 block",children:"Search Cases"}),e.jsxs("div",{className:"relative",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(xs,{id:"search",placeholder:"Search by patient name or EMR number...",value:l,onChange:r=>d(r.target.value),className:"pl-9"})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(De,{htmlFor:"queue",className:"text-sm font-medium mb-2 block",children:"Filter by Queue"}),e.jsxs(ps,{value:o,onValueChange:u,children:[e.jsx(gs,{children:e.jsx(bs,{})}),e.jsxs(ys,{children:[e.jsx(be,{value:"all",children:"All Queues"}),e.jsxs(be,{value:"doctor",children:["Doctor Queue",y&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Transferable)"})]}),e.jsx(be,{value:"pharmacist",children:"Pharmacist Queue"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(L,{onClick:f,variant:"outline",className:"flex items-center",children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse mr-2"}),e.jsx("span",{children:"Real-time updates enabled - Cases will automatically appear/disappear as they move between queues"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Total:"}),e.jsx(B,{variant:"outline",className:"text-xs",children:a||s})]}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Transferable:"}),e.jsxs(B,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:[e.jsx(Ke,{className:"h-2 w-2 mr-1"}),x]})]}),h>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Selected:"}),e.jsxs(B,{variant:"default",className:"text-xs bg-blue-600 text-white",children:[e.jsx(xe,{className:"h-2 w-2 mr-1"}),h]})]})]})]})]}),y&&(o!=="all"||l)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx("span",{className:"mr-2",children:"Active filters:"}),o!=="all"&&e.jsxs(B,{variant:"outline",className:"mr-2 text-xs",children:["Queue: ",o]}),l&&e.jsxs(B,{variant:"outline",className:"mr-2 text-xs",children:['Search: "',l,'"']}),e.jsx("span",{className:"text-amber-600",children:"• Bulk selection limited to filtered results"})]})})]}),y&&e.jsx("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("div",{className:"font-medium mb-2 flex items-center",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Bulk Transfer Tips"]}),e.jsx("ul",{className:"text-xs space-y-1 ml-6 list-disc",children:e.jsx("li",{children:"All transfer history will be preserved for each case"})})]})})]})]});function Je(s,a){if(typeof s=="function")return s(a);s!=null&&(s.current=a)}function Ys(...s){return a=>{let t=!1;const c=s.map(l=>{const d=Je(l,a);return!t&&typeof d=="function"&&(t=!0),d});if(t)return()=>{for(let l=0;l<c.length;l++){const d=c[l];typeof d=="function"?d():Je(s[l],null)}}}}function ts(...s){return n.useCallback(Ys(...s),s)}function Zs(s,a=[]){let t=[];function c(d,o){const u=n.createContext(o),p=t.length;t=[...t,o];const i=f=>{var $;const{scope:y,children:h,...x}=f,r=(($=y==null?void 0:y[s])==null?void 0:$[p])||u,E=n.useMemo(()=>x,Object.values(x));return e.jsx(r.Provider,{value:E,children:h})};i.displayName=d+"Provider";function N(f,y){var r;const h=((r=y==null?void 0:y[s])==null?void 0:r[p])||u,x=n.useContext(h);if(x)return x;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${d}\``)}return[i,N]}const l=()=>{const d=t.map(o=>n.createContext(o));return function(u){const p=(u==null?void 0:u[s])||d;return n.useMemo(()=>({[`__scope${s}`]:{...u,[s]:p}}),[u,p])}};return l.scopeName=s,[c,ea(l,...a)]}function ea(...s){const a=s[0];if(s.length===1)return a;const t=()=>{const c=s.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(d){const o=c.reduce((u,{useScope:p,scopeName:i})=>{const f=p(d)[`__scope${i}`];return{...u,...f}},{});return n.useMemo(()=>({[`__scope${a.scopeName}`]:o}),[o])}};return t.scopeName=a.scopeName,t}function Ye(s,a,{checkForDefaultPrevented:t=!0}={}){return function(l){if(s==null||s(l),t===!1||!l.defaultPrevented)return a==null?void 0:a(l)}}function rs(s){const a=n.useRef(s);return n.useEffect(()=>{a.current=s}),n.useMemo(()=>(...t)=>{var c;return(c=a.current)==null?void 0:c.call(a,...t)},[])}function sa({prop:s,defaultProp:a,onChange:t=()=>{}}){const[c,l]=aa({defaultProp:a,onChange:t}),d=s!==void 0,o=d?s:c,u=rs(t),p=n.useCallback(i=>{if(d){const f=typeof i=="function"?i(s):i;f!==s&&u(f)}else l(i)},[d,s,l,u]);return[o,p]}function aa({defaultProp:s,onChange:a}){const t=n.useState(s),[c]=t,l=n.useRef(c),d=rs(a);return n.useEffect(()=>{l.current!==c&&(d(c),l.current=c)},[c,l,d]),t}function ta(s){const a=n.useRef({value:s,previous:s});return n.useMemo(()=>(a.current.value!==s&&(a.current.previous=a.current.value,a.current.value=s),a.current.previous),[s])}var Ee=globalThis!=null&&globalThis.document?n.useLayoutEffect:()=>{};function ra(s){const[a,t]=n.useState(void 0);return Ee(()=>{if(s){t({width:s.offsetWidth,height:s.offsetHeight});const c=new ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const d=l[0];let o,u;if("borderBoxSize"in d){const p=d.borderBoxSize,i=Array.isArray(p)?p[0]:p;o=i.inlineSize,u=i.blockSize}else o=s.offsetWidth,u=s.offsetHeight;t({width:o,height:u})});return c.observe(s,{box:"border-box"}),()=>c.unobserve(s)}else t(void 0)},[s]),a}function na(s,a){return n.useReducer((t,c)=>a[t][c]??t,s)}var ns=s=>{const{present:a,children:t}=s,c=la(a),l=typeof t=="function"?t({present:c.isPresent}):n.Children.only(t),d=ts(c.ref,ca(l));return typeof t=="function"||c.isPresent?n.cloneElement(l,{ref:d}):null};ns.displayName="Presence";function la(s){const[a,t]=n.useState(),c=n.useRef({}),l=n.useRef(s),d=n.useRef("none"),o=s?"mounted":"unmounted",[u,p]=na(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return n.useEffect(()=>{const i=he(c.current);d.current=u==="mounted"?i:"none"},[u]),Ee(()=>{const i=c.current,N=l.current;if(N!==s){const y=d.current,h=he(i);s?p("MOUNT"):h==="none"||(i==null?void 0:i.display)==="none"?p("UNMOUNT"):p(N&&y!==h?"ANIMATION_OUT":"UNMOUNT"),l.current=s}},[s,p]),Ee(()=>{if(a){let i;const N=a.ownerDocument.defaultView??window,f=h=>{const r=he(c.current).includes(h.animationName);if(h.target===a&&r&&(p("ANIMATION_END"),!l.current)){const E=a.style.animationFillMode;a.style.animationFillMode="forwards",i=N.setTimeout(()=>{a.style.animationFillMode==="forwards"&&(a.style.animationFillMode=E)})}},y=h=>{h.target===a&&(d.current=he(c.current))};return a.addEventListener("animationstart",y),a.addEventListener("animationcancel",f),a.addEventListener("animationend",f),()=>{N.clearTimeout(i),a.removeEventListener("animationstart",y),a.removeEventListener("animationcancel",f),a.removeEventListener("animationend",f)}}else p("ANIMATION_END")},[a,p]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:n.useCallback(i=>{i&&(c.current=getComputedStyle(i)),t(i)},[])}}function he(s){return(s==null?void 0:s.animationName)||"none"}function ca(s){var c,l;let a=(c=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:c.get,t=a&&"isReactWarning"in a&&a.isReactWarning;return t?s.ref:(a=(l=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:l.get,t=a&&"isReactWarning"in a&&a.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}var ia=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ls=ia.reduce((s,a)=>{const t=js(`Primitive.${a}`),c=n.forwardRef((l,d)=>{const{asChild:o,...u}=l,p=o?t:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(p,{...u,ref:d})});return c.displayName=`Primitive.${a}`,{...s,[a]:c}},{}),Re="Checkbox",[oa,$a]=Zs(Re),[da,ua]=oa(Re),cs=n.forwardRef((s,a)=>{const{__scopeCheckbox:t,name:c,checked:l,defaultChecked:d,required:o,disabled:u,value:p="on",onCheckedChange:i,form:N,...f}=s,[y,h]=n.useState(null),x=ts(a,A=>h(A)),r=n.useRef(!1),E=y?N||!!y.closest("form"):!0,[$=!1,J]=sa({prop:l,defaultProp:d,onChange:i}),ae=n.useRef($);return n.useEffect(()=>{const A=y==null?void 0:y.form;if(A){const I=()=>J(ae.current);return A.addEventListener("reset",I),()=>A.removeEventListener("reset",I)}},[y,J]),e.jsxs(da,{scope:t,state:$,disabled:u,children:[e.jsx(ls.button,{type:"button",role:"checkbox","aria-checked":K($)?"mixed":$,"aria-required":o,"data-state":ds($),"data-disabled":u?"":void 0,disabled:u,value:p,...f,ref:x,onKeyDown:Ye(s.onKeyDown,A=>{A.key==="Enter"&&A.preventDefault()}),onClick:Ye(s.onClick,A=>{J(I=>K(I)?!0:!I),E&&(r.current=A.isPropagationStopped(),r.current||A.stopPropagation())})}),E&&e.jsx(ma,{control:y,bubbles:!r.current,name:c,value:p,checked:$,required:o,disabled:u,form:N,style:{transform:"translateX(-100%)"},defaultChecked:K(d)?!1:d})]})});cs.displayName=Re;var is="CheckboxIndicator",os=n.forwardRef((s,a)=>{const{__scopeCheckbox:t,forceMount:c,...l}=s,d=ua(is,t);return e.jsx(ns,{present:c||K(d.state)||d.state===!0,children:e.jsx(ls.span,{"data-state":ds(d.state),"data-disabled":d.disabled?"":void 0,...l,ref:a,style:{pointerEvents:"none",...s.style}})})});os.displayName=is;var ma=s=>{const{control:a,checked:t,bubbles:c=!0,defaultChecked:l,...d}=s,o=n.useRef(null),u=ta(t),p=ra(a);n.useEffect(()=>{const N=o.current,f=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(f,"checked").set;if(u!==t&&h){const x=new Event("click",{bubbles:c});N.indeterminate=K(t),h.call(N,K(t)?!1:t),N.dispatchEvent(x)}},[u,t,c]);const i=n.useRef(K(t)?!1:t);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l??i.current,...d,tabIndex:-1,ref:o,style:{...s.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function K(s){return s==="indeterminate"}function ds(s){return K(s)?"indeterminate":s?"checked":"unchecked"}var fa=cs,ha=os;function xa({className:s,...a}){return e.jsx(fa,{"data-slot":"checkbox",className:Cs("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(ha,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(vs,{className:"size-3.5"})})})}const pa=O.memo(({queue:s})=>s==="doctor"?e.jsxs(B,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Doctor Queue"]}):e.jsxs(B,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Pharmacist Queue"]}));O.memo(({status:s,caseCount:a})=>s==="unavailable"||s==="on_break"?e.jsx(X,{className:"h-4 w-4 text-red-500"}):a>=10?e.jsx(X,{className:"h-4 w-4 text-amber-500"}):e.jsx(pe,{className:"h-4 w-4 text-green-500"}));const ga=O.memo(({caseItem:s})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ss,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"font-medium",children:s.patientName})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["EMR: ",s.emrNumber]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.chiefComplaint})]})),ba=O.memo(({clinicCode:s,manualClinicCode:a})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 bg-purple-500 rounded-full mr-2"}),e.jsx("span",{className:"font-medium text-purple-700 text-sm",children:s})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 bg-purple-500 rounded-full mr-2"}),e.jsx("span",{className:"font-medium text-purple-700 text-sm",children:a??"N/A"})]})]})),ya=O.memo(({assignedDoctors:s,pharmacistId:a,pharmacistName:t,pharmacistStatus:c,transferHistory:l})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-4 w-4 text-blue-500 mr-2"}),e.jsx("span",{className:"font-medium text-sm",children:(s==null?void 0:s.primaryName)||"Not assigned"}),l&&l.length>0&&e.jsx(as,{className:"h-3 w-3 text-orange-500 ml-2",title:"Case has been transferred"})]}),(s==null?void 0:s.primaryType)&&e.jsx("span",{className:"text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded",children:s.primaryType})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-4 w-4 text-green-500 mr-2"}),e.jsx("span",{className:"font-medium text-sm",children:t||"Not assigned"})]}),c&&e.jsx("span",{className:"text-xs bg-green-50 text-green-700 px-2 py-1 rounded",children:c})]}),l&&l.length>0&&e.jsxs("div",{className:"text-xs text-orange-600",children:["Transfers: ",l.length]})]})),Na=O.memo(({consultationType:s})=>e.jsxs("div",{className:"flex items-center text-sm",children:[s==="tele"?e.jsx(Ts,{className:"h-4 w-4 text-indigo-500 mr-2"}):e.jsx(Hs,{className:"h-4 w-4 text-blue-500 mr-2"}),e.jsx("span",{className:"truncate max-w-32",children:s==="tele"?"Video Call":"Phone Call"})]})),Ze=O.memo(({createdAt:s,errorFallback:a="N/A"})=>{const t=n.useMemo(()=>{if(!s)return{date:a,time:a};let c;try{if(s&&typeof s.toDate=="function")c=s.toDate();else if(s instanceof Date)c=s;else if(typeof s=="number")c=new Date(s);else if(typeof s=="string")c=new Date(s);else return{date:a,time:a};return isNaN(c.getTime())?{date:a,time:a}:{date:Xe(c,"MMM dd"),time:Xe(c,"HH:mm")}}catch(l){return console.warn("Date formatting error:",l),{date:a,time:a}}},[s,a]);return e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ws,{className:"h-3 w-3 text-gray-400 mr-1"}),t.date]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ds,{className:"h-3 w-3 text-gray-400 mr-1"}),t.time]})]})}),Pe=O.memo(({isChecked:s,isIndeterminate:a,onChange:t,disabled:c=!1})=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(xa,{checked:s,onCheckedChange:t,disabled:c,className:"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600",indeterminate:a||void 0})})),ja=O.memo(({caseItem:s,onTransferClick:a,isSelected:t,onSelectChange:c,bulkMode:l})=>{const d=n.useCallback(()=>{a(s,"doctor")},[s,a]),o=n.useCallback(()=>{a(s,"pharmacist")},[s,a]),u=n.useCallback(i=>{c(s.id,i)},[s.id,c]),p=s.queue==="doctor";return e.jsxs(ss,{className:`hover:bg-gray-50 transition-colors duration-200 ${t?"bg-blue-50":""}`,children:[l&&e.jsx(H,{className:"w-12",children:e.jsx(Pe,{isChecked:t,onChange:u,disabled:!p&&!1})}),e.jsx(H,{children:e.jsx(ga,{caseItem:s})}),e.jsx(H,{children:e.jsx(ba,{clinicCode:s.clinicCode,manualClinicCode:s.manualClinicCode})}),e.jsx(H,{children:e.jsx(ya,{assignedDoctors:s.assignedDoctors,pharmacistId:s.pharmacistId,pharmacistName:s.pharmacistName,pharmacistStatus:s.pharmacistStatus,transferHistory:s.transferHistory})}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pa,{queue:s.queue}),e.jsx("div",{className:"ml-2 h-2 w-2 bg-green-400 rounded-full animate-pulse",title:"Live update enabled"})]})}),e.jsx(H,{children:e.jsx(Na,{consultationType:s.consultationType})}),e.jsx(H,{children:e.jsx(Ze,{createdAt:s.createdAt})}),e.jsx(H,{children:e.jsx(Ze,{createdAt:s.doctorJoined})}),e.jsx(H,{children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[p&&e.jsxs(L,{size:"sm",variant:"outline",onClick:d,className:"flex items-center text-blue-600 border-blue-200 hover:bg-blue-50",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Transfer Doctor"]}),e.jsxs(L,{size:"sm",variant:"outline",onClick:o,className:"flex items-center text-green-600 border-green-200 hover:bg-green-50",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Transfer Pharmacist"]}),s.queue==="pharmacist"&&!p&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(pe,{className:"h-3 w-3 text-green-500 mr-1"}),"Doctor completed"]})]})})]})}),Ca=20,va=5,Sa=(s,a=Ca)=>{const[t,c]=n.useState(1),l=n.useMemo(()=>{const i=Math.ceil(s.length/a),N=(t-1)*a,f=N+a,y=s.slice(N,f);return{totalPages:i,startIndex:N,endIndex:f,currentItems:y,totalItems:s.length}},[s,t,a]),d=n.useMemo(()=>{const i=[],{totalPages:N}=l;if(N<=va)for(let f=1;f<=N;f++)i.push(f);else if(t<=3){for(let f=1;f<=4;f++)i.push(f);i.push("..."),i.push(N)}else if(t>=N-2){i.push(1),i.push("...");for(let f=N-3;f<=N;f++)i.push(f)}else{i.push(1),i.push("...");for(let f=t-1;f<=t+1;f++)i.push(f);i.push("..."),i.push(N)}return i},[t,l.totalPages]),o=n.useCallback(()=>{c(i=>Math.min(i+1,l.totalPages))},[l.totalPages]),u=n.useCallback(()=>{c(i=>Math.max(i-1,1))},[]),p=n.useCallback(i=>{i>=1&&i<=l.totalPages&&c(i)},[l.totalPages]);return n.useEffect(()=>{c(1)},[s.length]),{...l,currentPage:t,pageNumbers:d,goToNextPage:o,goToPreviousPage:u,goToPage:p}},Ta=s=>{const[a,t]=n.useState(new Set),[c,l]=n.useState(!1),d=n.useMemo(()=>s.filter(h=>!0),[s]),o=n.useMemo(()=>d.map(h=>h.id),[d]),u=n.useMemo(()=>{const h=Array.from(a).filter(x=>o.includes(x)).length;return{selectedCount:h,totalTransferable:d.length,isAllSelected:h===d.length&&d.length>0,isIndeterminate:h>0&&h<d.length,hasSelection:h>0}},[a,d,o]),p=n.useCallback(()=>{l(h=>(h&&t(new Set),!h))},[]),i=n.useCallback((h,x)=>{t(r=>{const E=new Set(r);return x?E.add(h):E.delete(h),E})},[]),N=n.useCallback(h=>{t(x=>{const r=new Set(x);return o.forEach(E=>{h?r.add(E):r.delete(E)}),r})},[o]),f=n.useCallback(()=>{t(new Set)},[]),y=n.useCallback(()=>d.filter(h=>a.has(h.id)),[d,a]);return n.useEffect(()=>{t(h=>{const x=new Set(o),r=new Set(Array.from(h).filter(E=>x.has(E)));return r.size===h.size?h:r})},[o]),{bulkMode:c,selectedCases:a,selectionState:u,toggleBulkMode:p,selectCase:i,selectAllTransferable:N,clearSelection:f,getSelectedCases:y}},wa=()=>{const[s,a]=n.useState({open:!1,case:null,cases:[],selectedPersonId:"",transferType:"",isBulk:!1}),t=n.useCallback((o,u)=>{a({open:!0,case:o,cases:[],selectedPersonId:"",transferType:u,isBulk:!1})},[]),c=n.useCallback((o,u)=>o.length===0?{error:"Please select cases to transfer."}:(a({open:!0,case:null,cases:o,selectedPersonId:"",transferType:u,isBulk:!0}),{success:!0}),[]),l=n.useCallback(()=>{a({open:!1,case:null,cases:[],selectedPersonId:"",transferType:"",isBulk:!1})},[]),d=n.useCallback(o=>{a(u=>({...u,selectedPersonId:o}))},[]);return{transferDialog:s,openTransferDialog:t,openBulkTransferDialog:c,closeTransferDialog:l,updateSelectedPersonId:d}},us=()=>n.useMemo(()=>({control:(s,a)=>({...s,minHeight:"38px",borderColor:a.isFocused?"#3b82f6":"#d1d5db",boxShadow:a.isFocused?"0 0 0 1px #3b82f6":"none","&:hover":{borderColor:a.isFocused?"#3b82f6":"#9ca3af"},backgroundColor:"#ffffff",fontSize:"14px"}),menu:s=>({...s,zIndex:50,border:"1px solid #d1d5db",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",backgroundColor:"#ffffff"}),option:(s,a)=>({...s,backgroundColor:a.isSelected?"#3b82f6":a.isFocused?"#eff6ff":"white",color:a.isSelected?"white":"#374151",cursor:"pointer",padding:"10px 12px","&:active":{backgroundColor:a.isSelected?"#3b82f6":"#dbeafe"}}),singleValue:s=>({...s,color:"#374151"}),placeholder:s=>({...s,color:"#9ca3af"}),input:s=>({...s,color:"#374151"}),indicatorSeparator:s=>({...s,backgroundColor:"#d1d5db"}),dropdownIndicator:s=>({...s,color:"#6b7280","&:hover":{color:"#374151"}})}),[]),Da=()=>{const s=us();return n.useMemo(()=>({...s,control:(a,t)=>({...s.control(a,t),minHeight:"40px"}),option:(a,t)=>({...s.option(a,t),backgroundColor:t.isDisabled?"#f9fafb":t.isSelected?"#3b82f6":t.isFocused?"#eff6ff":"white",color:t.isDisabled?"#9ca3af":t.isSelected?"white":"#374151",cursor:t.isDisabled?"not-allowed":"pointer",padding:"8px 12px","&:active":{backgroundColor:t.isDisabled?"#f9fafb":t.isSelected?"#3b82f6":"#dbeafe"}})}),[s])},ka=(s,a)=>{const t=n.useMemo(()=>s.filter(u=>u.isAvailable).map(u=>{const p=u.caseCount<10,i=p?"":" (At Capacity)";return{value:u.id,label:`${u.name} (${u.caseCount}/10 cases)${i}`,person:u,isDisabled:!p}}),[s]),c=n.useMemo(()=>a.filter(u=>u.isAvailable).map(u=>{const p=u.caseCount<15,i=p?"":" (At Capacity)";return{value:u.id,label:`${u.name} (${u.caseCount}/15 cases)${i}`,person:u,isDisabled:!p}}),[a]),l=n.useMemo(()=>s.map(o=>({value:o.id,label:o.name,doctor:o})),[s]),d=n.useMemo(()=>a.map(o=>({value:o.id,label:o.name,pharmacist:o})),[a]);return{doctorOptions:t,pharmacistOptions:c,doctorFilterOptions:l,pharmacistFilterOptions:d}},Ea=({cases:s,doctors:a,pharmacists:t=[],loading:c,currentUser:l,onSuccess:d,onError:o})=>{var ee,Ae,Me,_e,Le,$e,Be,Oe,Ie,Fe;const[u,p]=n.useState(!1),[i,N]=n.useState(null),[f,y]=n.useState(null),h=n.useRef(!1),x=Ta(s),r=wa(),E=us(),$=Da(),{doctorOptions:J,pharmacistOptions:ae,doctorFilterOptions:A,pharmacistFilterOptions:I}=ka(a,t),g=n.useMemo(()=>{let m=s;return i&&(m=m.filter(C=>{var R;return((R=C.assignedDoctors)==null?void 0:R.primary)===i})),f&&(m=m.filter(C=>C.pharmacistId===f)),m},[s,i,f]),v=Sa(g),P=n.useCallback((m,C)=>{r.openTransferDialog(m,C)},[r]),S=n.useCallback(m=>{const C=x.getSelectedCases(),R=r.openBulkTransferDialog(C,m);R.error&&o(R.error)},[x,r,o]),k=n.useCallback(m=>{r.updateSelectedPersonId((m==null?void 0:m.value)||"")},[r]),w=n.useCallback(()=>{N(null)},[]),M=n.useCallback(()=>{y(null)},[]),b=n.useCallback(async()=>{var ze;const{case:m,cases:C,selectedPersonId:R,transferType:T,isBulk:se}=r.transferDialog;if(!R){o(`Please select a ${T} to transfer the case(s) to.`);return}const z=se?C:[m];if(z.length===0){o("No cases selected for transfer.");return}if(h.current){o("Transfer already in progress. Please wait.");return}p(!0),h.current=!0;try{const _=(T==="doctor"?a:t).find(U=>U.id===R);if(!_)throw new Error(`Selected ${T} not found`);const He=T==="doctor"?10:15,qe=_.caseCount||0;if(qe+z.length>He)throw new Error(`${_.name} cannot handle ${z.length} additional cases. Current: ${qe}/${He}`);if(se&&z.length>1){const U=ks(Q);z.forEach(F=>{var de,ue;const ge=We(Q,"cases",F.id),ie=T==="doctor"?(de=F.assignedDoctors)==null?void 0:de.primary:F.pharmacistId,oe=T==="doctor"?(ue=F.assignedDoctors)==null?void 0:ue.primaryName:F.pharmacistName,W={transferredAt:new Date,transferredBy:l.uid,transferredByName:l.displayName||l.name,transferType:T,transferredFrom:ie||null,transferredFromName:oe||"Unassigned",transferredTo:R,transferredToName:_.name,transferReason:`Bulk ${T} transfer`};let Z={transferHistory:[...F.transferHistory||[],W],transferCount:(F.transferCount||0)+1,lastTransferredAt:me(),lastModified:me()};T==="doctor"?Z={...Z,"assignedDoctors.primary":R,"assignedDoctors.primaryName":_.name,"assignedDoctors.primaryType":"bulk_transferred"}:Z={...Z,pharmacistId:R,pharmacistName:_.name,pharmacistStatus:_.availabilityStatus||"available",pharmacistType:"transferred"},U.update(ge,Z)}),await U.commit();const ce=`Successfully transferred ${z.length} cases to ${_.name} (${T})`;d(ce),x.clearSelection()}else{const U=z[0],ce=We(Q,"cases",U.id);await Es(Q,async ie=>{var Qe,Ue;const oe=await ie.get(ce);if(!oe.exists())throw new Error("Case not found");const W=oe.data(),Z=T==="doctor"?(Qe=W.assignedDoctors)==null?void 0:Qe.primary:W.pharmacistId,de=T==="doctor"?(Ue=W.assignedDoctors)==null?void 0:Ue.primaryName:W.pharmacistName,ue={transferredAt:new Date,transferredBy:l.uid,transferredByName:l.displayName||l.name,transferType:T,transferredFrom:Z||null,transferredFromName:de||"Unassigned",transferredTo:R,transferredToName:_.name,transferReason:`${T} transfer`};let te={transferHistory:[...W.transferHistory||[],ue],transferCount:(W.transferCount||0)+1,lastTransferredAt:me(),lastModified:me()};T==="doctor"?te={...te,"assignedDoctors.primary":R,"assignedDoctors.primaryName":_.name,"assignedDoctors.primaryType":"transferred"}:te={...te,pharmacistId:R,pharmacistName:_.name,pharmacistStatus:_.availabilityStatus||"available",pharmacistType:"transferred"},ie.update(ce,te)});const F=T==="doctor"?(ze=U.assignedDoctors)==null?void 0:ze.primaryName:U.pharmacistName,ge=F?`Case transferred from ${F} to ${_.name} (${T})`:`Case assigned to ${_.name} (${T})`;d(ge)}r.closeTransferDialog()}catch(Y){console.error("Error transferring case(s):",Y),Y.code==="permission-denied"?o("Permission denied. You may not have rights to transfer these cases."):Y.code==="not-found"?o("One or more cases no longer exist. They may have been deleted or transferred."):Y.message.includes("network")?o("Network error. Please check your connection and try again."):Y.message.includes("cannot handle")?o(Y.message):o("Transfer failed. Please try again in a moment.")}finally{p(!1),h.current=!1}},[r.transferDialog,a,t,l,d,o,r.closeTransferDialog,x]);if(c)return e.jsx("div",{className:"flex justify-center items-center py-12 border rounded-lg bg-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ge,{className:"h-8 w-8 animate-spin text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading cases with real-time updates..."})]})});if(s.length===0)return e.jsxs("div",{className:"text-center py-12 text-gray-500 border rounded-lg bg-white",children:[e.jsx(es,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"No pending cases found"}),e.jsx("p",{className:"text-sm",children:"All cases are either completed or don't match your filters."}),e.jsxs("div",{className:"mt-4 flex items-center justify-center text-xs text-gray-400",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse mr-2"}),"Real-time monitoring active"]})]});const j=r.transferDialog.transferType==="doctor"?J:ae,D=r.transferDialog.transferType==="doctor"?10:15;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(L,{variant:x.bulkMode?"default":"outline",onClick:x.toggleBulkMode,className:"flex items-center",children:[x.bulkMode?e.jsx(ke,{className:"h-4 w-4 mr-2"}):e.jsx(Xs,{className:"h-4 w-4 mr-2"}),x.bulkMode?"Exit Bulk Mode":"Bulk Select"]}),x.bulkMode&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{isChecked:x.selectionState.isAllSelected,isIndeterminate:x.selectionState.isIndeterminate,onChange:x.selectAllTransferable}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Select All (",x.selectionState.totalTransferable," transferable)"]})]}),x.selectionState.hasSelection&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(B,{variant:"secondary",className:"bg-blue-50 text-blue-700",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),x.selectionState.selectedCount," selected"]}),e.jsxs(L,{size:"sm",onClick:()=>S("doctor"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Transfer Doctors"]}),e.jsxs(L,{size:"sm",onClick:()=>S("pharmacist"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Transfer Pharmacists"]}),e.jsxs(L,{size:"sm",variant:"outline",onClick:x.clearSelection,className:"text-gray-600",children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),x.bulkMode&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Select cases to transfer doctors or pharmacists in bulk"]})]})}),e.jsx("div",{className:"bg-white border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter Cases"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"min-w-0 flex-1",style:{minWidth:"280px"},children:e.jsx(Ne,{options:A,value:A.find(m=>m.value===i)||null,onChange:m=>N((m==null?void 0:m.value)||null),placeholder:"Filter by doctor...",isSearchable:!0,isClearable:!0,menuPlacement:"bottom",styles:E,filterOption:(m,C)=>m.label.toLowerCase().includes(C.toLowerCase())})}),e.jsx("div",{className:"min-w-0 flex-1",style:{minWidth:"280px"},children:e.jsx(Ne,{options:I,value:I.find(m=>m.value===f)||null,onChange:m=>y((m==null?void 0:m.value)||null),placeholder:"Filter by pharmacist...",isSearchable:!0,isClearable:!0,menuPlacement:"bottom",styles:E,filterOption:(m,C)=>m.label.toLowerCase().includes(C.toLowerCase())})}),(i||f)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[i&&e.jsxs(L,{variant:"outline",size:"sm",onClick:w,className:"flex items-center text-gray-600 hover:text-gray-800",children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"Clear Doctor"]}),f&&e.jsxs(L,{variant:"outline",size:"sm",onClick:M,className:"flex items-center text-gray-600 hover:text-gray-800",children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"Clear Pharmacist"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[i&&e.jsxs(B,{variant:"secondary",className:"bg-blue-50 text-blue-700",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Dr. ",(ee=A.find(m=>m.value===i))==null?void 0:ee.label]}),f&&e.jsxs(B,{variant:"secondary",className:"bg-green-50 text-green-700",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),(Ae=I.find(m=>m.value===f))==null?void 0:Ae.label]}),(i||f)&&e.jsxs("span",{className:"text-xs",children:[g.length," of ",s.length," cases"]})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("div",{className:"h-2 w-2 bg-green-400 rounded-full animate-pulse mr-2"}),"Live updates active"]})]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-white",children:e.jsxs(Rs,{children:[e.jsx(As,{className:"bg-gray-50",children:e.jsxs(ss,{children:[x.bulkMode&&e.jsx(q,{className:"w-12",children:e.jsx(Pe,{isChecked:x.selectionState.isAllSelected,isIndeterminate:x.selectionState.isIndeterminate,onChange:x.selectAllTransferable})}),e.jsx(q,{className:"font-semibold",children:"Patient Info"}),e.jsx(q,{className:"font-semibold",children:"Clinic Code"}),e.jsx(q,{className:"font-semibold",children:"Assignments"}),e.jsx(q,{className:"font-semibold",children:"Queue Status"}),e.jsx(q,{className:"font-semibold",children:"Contact"}),e.jsx(q,{className:"font-semibold",children:"Created"}),e.jsx(q,{className:"font-semibold",children:"Doctor Joined"}),e.jsx(q,{className:"font-semibold",children:"Actions"})]})}),e.jsx(Ms,{children:v.currentItems.map(m=>e.jsx(ja,{caseItem:m,onTransferClick:P,isSelected:x.selectedCases.has(m.id),onSelectChange:x.selectCase,bulkMode:x.bulkMode},m.id))})]})}),v.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between bg-white px-4 py-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700",children:[e.jsxs("span",{children:["Showing ",v.startIndex+1," to"," ",Math.min(v.endIndex,g.length)," of"," ",g.length,i||f?" filtered":""," cases"]}),x.bulkMode&&x.selectionState.hasSelection&&e.jsxs("span",{className:"ml-4 text-blue-600",children:["• ",x.selectionState.selectedCount," selected for transfer"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:v.goToPreviousPage,disabled:v.currentPage===1,className:"flex items-center",children:[e.jsx(_s,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-1",children:v.pageNumbers.map((m,C)=>e.jsx(O.Fragment,{children:m==="..."?e.jsx("span",{className:"px-2 py-1 text-gray-500",children:e.jsx(Ws,{className:"h-4 w-4"})}):e.jsx(L,{variant:v.currentPage===m?"default":"outline",size:"sm",onClick:()=>v.goToPage(m),className:`min-w-[32px] h-8 ${v.currentPage===m?"bg-blue-600 text-white":"text-gray-700"}`,children:m})},C))}),e.jsxs(L,{variant:"outline",size:"sm",onClick:v.goToNextPage,disabled:v.currentPage===v.totalPages,className:"flex items-center",children:["Next",e.jsx(Ls,{className:"h-4 w-4 ml-1"})]})]})]})]}),e.jsx($s,{open:r.transferDialog.open,onOpenChange:r.closeTransferDialog,children:e.jsxs(Bs,{className:"sm:max-w-2xl",children:[e.jsxs(Os,{children:[e.jsxs(Is,{className:"flex items-center",children:[r.transferDialog.transferType==="doctor"?e.jsx(G,{className:"h-5 w-5 text-blue-500 mr-2"}):e.jsx(V,{className:"h-5 w-5 text-green-500 mr-2"}),r.transferDialog.isBulk?"Bulk Transfer":"Transfer"," ",r.transferDialog.transferType==="doctor"?"Doctor":"Pharmacist"]}),e.jsx(Fs,{children:r.transferDialog.isBulk?`Select an available ${r.transferDialog.transferType} to transfer ${r.transferDialog.cases.length} selected cases to.`:`Select an available ${r.transferDialog.transferType} to transfer this case to.`})]}),e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[!r.transferDialog.isBulk&&r.transferDialog.case&&e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Patient:"})," ",r.transferDialog.case.patientName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"EMR:"})," ",r.transferDialog.case.emrNumber]}),e.jsxs("div",{children:[e.jsxs("strong",{children:["Current ",r.transferDialog.transferType==="doctor"?"Doctor":"Pharmacist",":"]})," ",r.transferDialog.transferType==="doctor"?((Me=r.transferDialog.case.assignedDoctors)==null?void 0:Me.primaryName)||"Not assigned":r.transferDialog.case.pharmacistName||"Not assigned"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Clinic:"})," ",r.transferDialog.case.clinicCode," ",r.transferDialog.case.manualClinicCode?`(${r.transferDialog.case.manualClinicCode})`:""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Complaint:"})," ",r.transferDialog.case.chiefComplaint]}),r.transferDialog.case.transferCount>0&&e.jsxs("div",{className:"text-orange-600",children:[e.jsx("strong",{children:"Previous Transfers:"})," ",r.transferDialog.case.transferCount]})]})}),r.transferDialog.isBulk&&r.transferDialog.cases.length>0&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Selected Cases (",r.transferDialog.cases.length,")"]}),e.jsxs(B,{variant:"secondary",className:`${r.transferDialog.transferType==="doctor"?"bg-blue-50 text-blue-700":"bg-green-50 text-green-700"}`,children:[r.transferDialog.transferType==="doctor"?e.jsx(G,{className:"h-3 w-3 mr-1"}):e.jsx(V,{className:"h-3 w-3 mr-1"}),"Bulk ",r.transferDialog.transferType==="doctor"?"Doctor":"Pharmacist"," Transfer"]})]}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:r.transferDialog.cases.map(m=>{var C;return e.jsxs("div",{className:`text-sm border-l-2 ${r.transferDialog.transferType==="doctor"?"border-blue-300":"border-green-300"} pl-3 py-1`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:m.patientName}),e.jsxs("span",{className:"text-gray-600 ml-2",children:["EMR: ",m.emrNumber]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:r.transferDialog.transferType==="doctor"?((C=m.assignedDoctors)==null?void 0:C.primaryName)||"Unassigned":m.pharmacistName||"Unassigned"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[m.clinicCode," • ",m.chiefComplaint]})]},m.id)})}),e.jsx("div",{className:`mt-3 p-2 rounded border ${r.transferDialog.transferType==="doctor"?"bg-blue-50 border-blue-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:`text-xs ${r.transferDialog.transferType==="doctor"?"text-blue-800":"text-green-800"}`,children:[e.jsx("strong",{children:"Transfer Summary:"})," All ",r.transferDialog.cases.length," cases will have their ",r.transferDialog.transferType," changed to the selected person with full history tracking."]})})]}),(((Le=(_e=r.transferDialog.case)==null?void 0:_e.transferHistory)==null?void 0:Le.length)>0||r.transferDialog.cases.some(m=>{var C;return((C=m.transferHistory)==null?void 0:C.length)>0}))&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(as,{className:"h-4 w-4 text-amber-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Transfer History Warning"})]}),e.jsx("div",{className:"text-xs text-amber-700",children:r.transferDialog.isBulk?"Some of the selected cases have been transferred before. Transfer history will be preserved.":`This case has been transferred ${(Be=($e=r.transferDialog.case)==null?void 0:$e.transferHistory)==null?void 0:Be.length} time(s) previously.`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(De,{children:["Select New ",r.transferDialog.transferType==="doctor"?"Doctor":"Pharmacist"]}),e.jsx(Ne,{options:j,value:j.find(m=>m.value===r.transferDialog.selectedPersonId)||null,onChange:k,placeholder:`Select ${r.transferDialog.transferType}...`,isSearchable:!0,isClearable:!0,isOptionDisabled:m=>m.isDisabled,menuPlacement:"bottom",menuShouldBlockScroll:!0,styles:$,filterOption:(m,C)=>m.label.toLowerCase().includes(C.toLowerCase())}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Available ",r.transferDialog.transferType,"s are shown. ",r.transferDialog.transferType==="doctor"?"Doctors":"Pharmacists"," at capacity (",D,"+ cases) are disabled.",r.transferDialog.isBulk&&` Selected ${r.transferDialog.transferType} must be able to handle ${r.transferDialog.cases.length} additional cases.`]})]}),r.transferDialog.isBulk&&r.transferDialog.selectedPersonId&&e.jsx("div",{className:`p-3 rounded-lg ${r.transferDialog.transferType==="doctor"?"bg-blue-50":"bg-green-50"}`,children:(()=>{const C=(r.transferDialog.transferType==="doctor"?a:t).find(z=>z.id===r.transferDialog.selectedPersonId),R=(C==null?void 0:C.caseCount)||0,T=R+r.transferDialog.cases.length,se=T<=D;return e.jsxs("div",{className:"flex items-center",children:[se?e.jsx(pe,{className:"h-4 w-4 text-green-600 mr-2"}):e.jsx(X,{className:"h-4 w-4 text-red-600 mr-2"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:se?"text-green-900":"text-red-900",children:[e.jsx("strong",{children:C==null?void 0:C.name})," case load: ",R," → ",T,"/",D]}),!se&&e.jsxs("div",{className:"text-red-700 text-xs mt-1",children:["Cannot handle ",r.transferDialog.cases.length," additional cases. Please select a different ",r.transferDialog.transferType,"."]})]})]})})()}),r.transferDialog.selectedPersonId&&!r.transferDialog.isBulk&&e.jsxs("div",{className:`p-3 rounded-lg ${r.transferDialog.transferType==="doctor"?"bg-blue-50":"bg-green-50"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qs,{className:`h-4 w-4 mr-2 ${r.transferDialog.transferType==="doctor"?"text-blue-600":"text-green-600"}`}),e.jsxs("span",{className:`text-sm font-medium ${r.transferDialog.transferType==="doctor"?"text-blue-900":"text-green-900"}`,children:["Transferring ",r.transferDialog.transferType," from:"," ",r.transferDialog.transferType==="doctor"?((Oe=r.transferDialog.case.assignedDoctors)==null?void 0:Oe.primaryName)||"Unassigned":r.transferDialog.case.pharmacistName||"Unassigned"," → "," ",(Fe=(Ie=j.find(m=>m.value===r.transferDialog.selectedPersonId))==null?void 0:Ie.person)==null?void 0:Fe.name]})]}),e.jsxs("div",{className:`mt-2 flex items-center text-xs ${r.transferDialog.transferType==="doctor"?"text-blue-700":"text-green-700"}`,children:[e.jsx("div",{className:`h-2 w-2 rounded-full animate-pulse mr-2 ${r.transferDialog.transferType==="doctor"?"bg-blue-500":"bg-green-500"}`}),"Transfer history will be automatically recorded"]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(X,{className:"h-4 w-4 text-amber-600 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"Transfer Tracking:"})," ",r.transferDialog.isBulk?"These transfers":"This transfer"," will be recorded with full history including previous ",r.transferDialog.transferType,", timestamp, and reason. ",r.transferDialog.isBulk?"All cases":"The case"," will immediately reflect the new ",r.transferDialog.transferType," assignment."]})]})})]}),e.jsxs(zs,{className:"pt-4",children:[e.jsx(L,{variant:"outline",onClick:r.closeTransferDialog,children:"Cancel"}),e.jsx(L,{onClick:b,disabled:!r.transferDialog.selectedPersonId||u||r.transferDialog.isBulk&&(()=>{const C=(r.transferDialog.transferType==="doctor"?a:t).find(T=>T.id===r.transferDialog.selectedPersonId);return((C==null?void 0:C.caseCount)||0)+r.transferDialog.cases.length>D})(),className:r.transferDialog.transferType==="doctor"?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4 mr-2 animate-spin"}),(r.transferDialog.isBulk,"Transferring...")]}):e.jsxs(e.Fragment,{children:[r.transferDialog.transferType==="doctor"?e.jsx(G,{className:"h-4 w-4 mr-2"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),r.transferDialog.isBulk?`Transfer ${r.transferDialog.cases.length} Cases`:"Transfer"]})})]})]})})]})},Pa=O.memo(Ea),Ra=(s,a)=>{switch(a.type){case"SET_LOADING":return{...s,loading:a.payload};case"SET_ERROR":return{...s,error:a.payload};case"SET_SUCCESS":return{...s,success:a.payload};case"SET_CASES":return{...s,cases:a.payload};case"SET_DOCTORS":return{...s,doctors:a.payload};case"SET_PHARMACISTS":return{...s,pharmacists:a.payload};case"SET_CLINICS":return{...s,clinics:a.payload};case"SET_SEARCH_TERM":return{...s,searchTerm:a.payload};case"SET_SELECTED_QUEUE":return{...s,selectedQueue:a.payload};case"SET_SELECTED_CLINIC":return{...s,selectedClinic:a.payload};case"CLEAR_MESSAGES":return{...s,error:"",success:""};default:return s}},Aa={cases:[],doctors:[],pharmacists:[],clinics:[],loading:!0,error:"",success:"",searchTerm:"",selectedQueue:"all",selectedClinic:"all"},Ma=({currentUser:s})=>{const[a,t]=n.useReducer(Ra,Aa),[c,l]=n.useState([]),d=n.useRef(null),o=n.useRef(new Map),u=n.useRef(new Map),p=n.useRef(new Map),i=n.useMemo(()=>(s==null?void 0:s.role)==="teamLeader"||(s==null?void 0:s.role)==="superAdmin",[s==null?void 0:s.role]),N=n.useMemo(()=>a.cases.length?a.cases.filter(g=>{var v,P,S;if(a.selectedQueue!=="all"&&g.queue!==a.selectedQueue||a.selectedClinic!=="all"&&g.clinicCode!==a.selectedClinic)return!1;if(a.searchTerm){const k=a.searchTerm.toLowerCase(),w=((v=g.patientName)==null?void 0:v.toLowerCase())||"",M=((P=g.emrNumber)==null?void 0:P.toLowerCase())||"",b=((S=g.clinicCode)==null?void 0:S.toLowerCase())||"";if(!w.includes(k)&&!M.includes(k)&&!b.includes(k))return!1}return!0}):[],[a.cases,a.searchTerm,a.selectedQueue,a.selectedClinic]),f=n.useMemo(()=>N.filter(g=>g.queue==="doctor").length,[N]),y=n.useCallback(()=>{try{t({type:"SET_LOADING",payload:!0}),t({type:"SET_ERROR",payload:""});const g=je(Q,"cases"),v=Ce(g,fe("status","in",["pending","doctor_completed"]),fe("isIncomplete","!=",!0),Ve("isIncomplete"),Ve("createdAt","desc"),ve(800)),P=k=>{var b,j,D;const w=k.data(),M=w.status==="pending"&&!w.doctorCompleted?"doctor":"pharmacist";return{id:k.id,...w,queue:M,createdAt:((b=w.createdAt)==null?void 0:b.toDate())||new Date,doctorCompletedAt:((j=w.doctorCompletedAt)==null?void 0:j.toDate())||null,pharmacistCompletedAt:((D=w.pharmacistCompletedAt)==null?void 0:D.toDate())||null,clinicCode:w.clinicCode||"N/A"}};return[Se(v,k=>{const w=new Map,M=[];k.forEach(b=>{const j=P(b);w.set(b.id,j),M.push(j)}),o.current=w,M.sort((b,j)=>j.createdAt-b.createdAt),t({type:"SET_CASES",payload:M}),t({type:"SET_LOADING",payload:!1})},k=>{console.error("Error in cases listener:",k),t({type:"SET_ERROR",payload:"Failed to load cases."}),t({type:"SET_LOADING",payload:!1})})]}catch(g){return console.error("Error setting up cases listener:",g),t({type:"SET_ERROR",payload:"Failed to setup real-time case updates."}),t({type:"SET_LOADING",payload:!1}),[]}},[]),h=n.useCallback(()=>((()=>{const v=new Set;a.cases.forEach(S=>{S.clinicCode&&S.clinicCode!=="N/A"&&v.add(S.clinicCode)});const P=Array.from(v).sort().map(S=>({code:S,name:S}));t({type:"SET_CLINICS",payload:P})})(),()=>{}),[a.cases]),x=n.useCallback(()=>{try{const g=Ce(je(Q,"users"),fe("role","==","doctor"),ve(400));return[Se(g,P=>{const S=[],k=new Map;P.forEach(b=>{const j=b.data(),D={id:b.id,name:j.name,availabilityStatus:j.availabilityStatus||"available"};S.push(D),k.set(b.id,D)});const w=new Map;o.current.forEach(b=>{var D;const j=(D=b.assignedDoctors)==null?void 0:D.primary;j&&b.queue==="doctor"&&w.set(j,(w.get(j)||0)+1)});const M=S.map(b=>{const j=w.get(b.id)||0,D=b.availabilityStatus==="available"||b.availabilityStatus==="busy",ee=D&&j<10;return{...b,caseCount:j,isAvailable:D,canAcceptCases:ee}});M.sort((b,j)=>b.isAvailable!==j.isAvailable?b.isAvailable?-1:1:b.caseCount-j.caseCount),u.current=k,t({type:"SET_DOCTORS",payload:M})},P=>{console.error("Error in doctors listener:",P),t({type:"SET_ERROR",payload:"Failed to load doctors data."})})]}catch(g){return console.error("Error setting up doctors listener:",g),t({type:"SET_ERROR",payload:"Failed to setup real-time doctor updates."}),[]}},[]),r=n.useCallback(()=>{try{const g=Ce(je(Q,"users"),fe("role","==","pharmacist"),ve(400));return[Se(g,P=>{const S=[],k=new Map;P.forEach(b=>{const j=b.data(),D={id:b.id,name:j.name,availabilityStatus:j.availabilityStatus||"available"};S.push(D),k.set(b.id,D)});const w=new Map;o.current.forEach(b=>{const j=b.pharmacistId;j&&w.set(j,(w.get(j)||0)+1)});const M=S.map(b=>{const j=w.get(b.id)||0,D=b.availabilityStatus==="available"||b.availabilityStatus==="busy",ee=D&&j<15;return{...b,caseCount:j,isAvailable:D,canAcceptCases:ee}});M.sort((b,j)=>b.isAvailable!==j.isAvailable?b.isAvailable?-1:1:b.caseCount-j.caseCount),p.current=k,t({type:"SET_PHARMACISTS",payload:M})},P=>{console.error("Error in pharmacists listener:",P),t({type:"SET_ERROR",payload:"Failed to load pharmacists data."})})]}catch(g){return console.error("Error setting up pharmacists listener:",g),t({type:"SET_ERROR",payload:"Failed to setup real-time pharmacist updates."}),[]}},[]);n.useEffect(()=>{if(i&&Q){const g=y(),v=x(),P=r(),S=[...g,...v,...P].filter(Boolean);return l(S),()=>{S.forEach(k=>{typeof k=="function"&&k()})}}},[s,i,y,x,r]),n.useEffect(()=>{h()},[h]),n.useEffect(()=>()=>{d.current&&clearTimeout(d.current),c.forEach(g=>{typeof g=="function"&&g()})},[c]),n.useCallback(g=>{t({type:"SET_SUCCESS",payload:g}),t({type:"SET_ERROR",payload:""}),setTimeout(()=>t({type:"SET_SUCCESS",payload:""}),3e3)},[]);const E=n.useCallback(g=>{t({type:"SET_ERROR",payload:g}),t({type:"SET_SUCCESS",payload:""})},[]),$=n.useCallback(g=>{t({type:"SET_SEARCH_TERM",payload:g})},[]),J=n.useCallback(g=>{t({type:"SET_SELECTED_QUEUE",payload:g})},[]),ae=n.useCallback(g=>{t({type:"SET_SELECTED_CLINIC",payload:g})},[]),A=n.useCallback(()=>{t({type:"CLEAR_MESSAGES"}),t({type:"SET_SUCCESS",payload:"Data refreshed successfully!"})},[]),I=n.useCallback((g,v=0)=>{const P=v>1?`${g} (${v} cases transferred)`:g;t({type:"SET_SUCCESS",payload:P}),t({type:"SET_ERROR",payload:""});const S=v>1?5e3:3e3;setTimeout(()=>t({type:"SET_SUCCESS",payload:""}),S)},[]);return Q?i?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Js,{filteredCasesCount:N.length,totalCasesCount:a.cases.length,error:a.error,success:a.success,searchTerm:a.searchTerm,setSearchTerm:$,selectedQueue:a.selectedQueue,setSelectedQueue:J,selectedClinic:a.selectedClinic,setSelectedClinic:ae,clinics:a.clinics,onRefresh:A,transferableCasesCount:f}),e.jsx(Pa,{cases:N,doctors:a.doctors,pharmacists:a.pharmacists,loading:a.loading,currentUser:s,onSuccess:I,onError:E})]}):e.jsx(Te,{className:"border border-red-200",children:e.jsx(we,{className:"pt-6",children:e.jsxs(re,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(ne,{children:"You don't have permission to access case transfer functionality. Only Team Leaders can transfer cases."})]})})}):e.jsx(Te,{className:"border border-red-200",children:e.jsx(we,{className:"pt-6",children:e.jsxs(re,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(ne,{children:"Firebase is not properly initialized. Please check your Firebase configuration."})]})})})},Ba=O.memo(Ma);export{Ba as default};
